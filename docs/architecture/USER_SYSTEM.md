# ç”¨æˆ·ç³»ç»Ÿè®¾è®¡æ€»ç»“

## ç³»ç»Ÿæ¦‚è¿°

æˆ‘ä»¬æˆåŠŸè®¾è®¡å¹¶å®ç°äº†å®Œæ•´çš„ç”¨æˆ·ç³»ç»Ÿï¼ŒåŒ…æ‹¬å‰ç«¯ç™»å½•é¡µé¢ã€åç«¯è®¤è¯APIã€æ•°æ®åº“è®¾è®¡å’Œç”¨æˆ·ç®¡ç†åŠŸèƒ½ã€‚

## ä¸»è¦åŠŸèƒ½

### ğŸ” 1. ç”¨æˆ·è®¤è¯ç³»ç»Ÿ

#### åç«¯æŠ€æœ¯æ ˆ
- **FastAPI**: Webæ¡†æ¶
- **Tortoise ORM**: å¼‚æ­¥ORM
- **SQLite**: æ•°æ®åº“
- **JWT**: ä»¤ç‰Œè®¤è¯
- **SHA256**: å¯†ç å“ˆå¸Œ

#### å‰ç«¯æŠ€æœ¯æ 
- **React**: å‰ç«¯æ¡†æ¶
- **Ant Design**: UIç»„ä»¶åº“
- **TypeScript**: ç±»å‹å®‰å…¨
- **React Router**: è·¯ç”±ç®¡ç†

### ğŸ—„ï¸ 2. æ•°æ®åº“è®¾è®¡

#### ç”¨æˆ·è¡¨ (users)
```sql
- id: ä¸»é”®
- username: ç”¨æˆ·åï¼ˆå”¯ä¸€ï¼‰
- email: é‚®ç®±ï¼ˆå”¯ä¸€ï¼Œå¯é€‰ï¼‰
- password_hash: å¯†ç å“ˆå¸Œ
- full_name: å…¨åï¼ˆå¯é€‰ï¼‰
- avatar_url: å¤´åƒURLï¼ˆå¯é€‰ï¼‰
- is_active: æ˜¯å¦æ¿€æ´»
- is_superuser: æ˜¯å¦è¶…çº§ç”¨æˆ·
- created_at: åˆ›å»ºæ—¶é—´
- updated_at: æ›´æ–°æ—¶é—´
- last_login: æœ€åç™»å½•æ—¶é—´
```

#### ç”¨æˆ·ä¼šè¯è¡¨ (user_sessions)
```sql
- id: ä¸»é”®
- user_id: ç”¨æˆ·IDï¼ˆå¤–é”®ï¼‰
- token: ä¼šè¯ä»¤ç‰Œ
- expires_at: è¿‡æœŸæ—¶é—´
- created_at: åˆ›å»ºæ—¶é—´
- is_active: æ˜¯å¦æ¿€æ´»
```

### ğŸ”‘ 3. é¢„è®¾æµ‹è¯•è´¦æˆ·

#### é»˜è®¤ç”¨æˆ·ä¿¡æ¯
- **ç”¨æˆ·å**: test
- **å¯†ç **: test
- **é‚®ç®±**: test@example.com
- **å…¨å**: æµ‹è¯•ç”¨æˆ·
- **æƒé™**: è¶…çº§ç®¡ç†å‘˜

## æŠ€æœ¯å®ç°

### ğŸ”§ 1. åç«¯APIè®¾è®¡

#### è®¤è¯è·¯ç”± (/api/auth)
```python
POST /api/auth/login          # ç”¨æˆ·ç™»å½•
POST /api/auth/register       # ç”¨æˆ·æ³¨å†Œ
GET  /api/auth/me            # è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
PUT  /api/auth/me            # æ›´æ–°ç”¨æˆ·ä¿¡æ¯
POST /api/auth/change-password # ä¿®æ”¹å¯†ç 
POST /api/auth/logout        # ç”¨æˆ·ç™»å‡º
```

#### æ•°æ®æ¨¡å‹
```python
# ç”¨æˆ·æ¨¡å‹
class User(Model):
    username = fields.CharField(max_length=50, unique=True)
    email = fields.CharField(max_length=100, unique=True, null=True)
    password_hash = fields.CharField(max_length=255)
    # ... å…¶ä»–å­—æ®µ

# è®¤è¯è¯·æ±‚æ¨¡å‹
class UserLogin(BaseModel):
    username: str
    password: str

class UserUpdate(BaseModel):
    email: Optional[str]
    full_name: Optional[str]
    avatar_url: Optional[str]
```

### ğŸ¨ 2. å‰ç«¯é¡µé¢è®¾è®¡

#### ç™»å½•é¡µé¢ (/login)
- **è®¾è®¡é£æ ¼**: ç°ä»£åŒ–å¡ç‰‡å¸ƒå±€
- **åŠŸèƒ½ç‰¹æ€§**:
  - é¢„å¡«æµ‹è¯•è´¦æˆ·ä¿¡æ¯
  - è¡¨å•éªŒè¯
  - åŠ è½½çŠ¶æ€
  - é”™è¯¯æç¤º
- **ç”¨æˆ·ä½“éªŒ**:
  - æ¸å˜èƒŒæ™¯
  - å“åº”å¼è®¾è®¡
  - å‹å¥½çš„æç¤ºä¿¡æ¯

#### ç”¨æˆ·èµ„æ–™é¡µé¢ (/profile)
- **åŠŸèƒ½æ¨¡å—**:
  - åŸºæœ¬ä¿¡æ¯å±•ç¤º
  - ä¸ªäººèµ„æ–™ç¼–è¾‘
  - å¯†ç ä¿®æ”¹
  - å¤´åƒç®¡ç†
- **äº¤äº’è®¾è®¡**:
  - è¡¨å•éªŒè¯
  - å®æ—¶ä¿å­˜
  - æ¨¡æ€æ¡†äº¤äº’

#### å¯¼èˆªæ ç”¨æˆ·èœå•
- **ä¸‹æ‹‰èœå•**: æ‚¬åœ/ç‚¹å‡»è§¦å‘
- **ç”¨æˆ·ä¿¡æ¯**: å¤´åƒ + å§“å + è§’è‰²æ ‡è¯†
- **èœå•é€‰é¡¹**: ä¸ªäººèµ„æ–™ã€è´¦æˆ·è®¾ç½®ã€é€€å‡ºç™»å½•

### ğŸ”’ 3. å®‰å…¨æœºåˆ¶

#### JWTä»¤ç‰Œè®¤è¯
```typescript
// ä»¤ç‰Œå­˜å‚¨
localStorage.setItem('token', response.access_token);

// è¯·æ±‚å¤´è®¤è¯
headers: {
  'Authorization': `Bearer ${token}`
}

// ä»¤ç‰ŒéªŒè¯
const payload = jwt.decode(token, SECRET_KEY);
```

#### è·¯ç”±ä¿æŠ¤
```typescript
// è®¤è¯ä¿æŠ¤ç»„ä»¶
const ProtectedRoute: React.FC<{ children: React.ReactNode }> = ({ children }) => {
  return isAuthenticated() ? <>{children}</> : <Navigate to="/login" replace />;
};
```

#### å¯†ç å®‰å…¨
```python
# å¯†ç å“ˆå¸Œ
def get_password_hash(password: str) -> str:
    return hashlib.sha256(password.encode()).hexdigest()

# å¯†ç éªŒè¯
def verify_password(plain_password: str, hashed_password: str) -> bool:
    return get_password_hash(plain_password) == hashed_password
```

## æ–‡ä»¶ç»“æ„

### åç«¯æ–‡ä»¶
```
backend/
â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ user.py              # ç”¨æˆ·æ¨¡å‹
â”‚   â””â”€â”€ auth.py              # è®¤è¯æ•°æ®æ¨¡å‹
â”œâ”€â”€ services/
â”‚   â””â”€â”€ auth_service.py      # è®¤è¯æœåŠ¡
â”œâ”€â”€ api/
â”‚   â””â”€â”€ auth.py              # è®¤è¯APIè·¯ç”±
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ security.py          # å®‰å…¨å·¥å…·
â”‚   â”œâ”€â”€ deps.py              # ä¾èµ–æ³¨å…¥
â”‚   â””â”€â”€ database.py          # æ•°æ®åº“é…ç½®
â”œâ”€â”€ data/
â”‚   â””â”€â”€ aitestlab.db         # SQLiteæ•°æ®åº“
â””â”€â”€ init_db.py               # æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬
```

### å‰ç«¯æ–‡ä»¶
```
frontend/src/
â”œâ”€â”€ pages/
â”‚   â”œâ”€â”€ LoginPage.tsx        # ç™»å½•é¡µé¢
â”‚   â””â”€â”€ UserProfilePage.tsx  # ç”¨æˆ·èµ„æ–™é¡µé¢
â”œâ”€â”€ services/
â”‚   â””â”€â”€ auth.ts              # è®¤è¯æœåŠ¡
â””â”€â”€ components/
    â””â”€â”€ TopNavigation.tsx    # é¡¶éƒ¨å¯¼èˆªï¼ˆå«ç”¨æˆ·èœå•ï¼‰
```

## ä½¿ç”¨æŒ‡å—

### ğŸš€ 1. ç³»ç»Ÿå¯åŠ¨
```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡
make start

# è®¿é—®åœ°å€
å‰ç«¯: http://localhost:3000
åç«¯: http://localhost:8000
APIæ–‡æ¡£: http://localhost:8000/docs
```

### ğŸ‘¤ 2. ç”¨æˆ·æ“ä½œæµç¨‹

#### ç™»å½•æµç¨‹
1. è®¿é—® http://localhost:3000
2. è‡ªåŠ¨è·³è½¬åˆ°ç™»å½•é¡µé¢
3. ä½¿ç”¨æµ‹è¯•è´¦æˆ·ç™»å½•ï¼š
   - ç”¨æˆ·å: test
   - å¯†ç : test
4. ç™»å½•æˆåŠŸåè·³è½¬åˆ°é¦–é¡µ

#### ç”¨æˆ·ç®¡ç†
1. ç‚¹å‡»å³ä¸Šè§’ç”¨æˆ·å¤´åƒ
2. é€‰æ‹©"ä¸ªäººèµ„æ–™"è¿›å…¥ç”¨æˆ·è¯¦æƒ…é¡µ
3. ç¼–è¾‘ä¸ªäººä¿¡æ¯ï¼š
   - é‚®ç®±
   - å…¨å
   - å¤´åƒURL
4. ä¿®æ”¹å¯†ç ï¼š
   - è¾“å…¥å½“å‰å¯†ç 
   - è®¾ç½®æ–°å¯†ç 
   - ç¡®è®¤æ–°å¯†ç 

### ğŸ”§ 3. å¼€å‘æ‰©å±•

#### æ·»åŠ æ–°çš„è®¤è¯åŠŸèƒ½
```python
# 1. åœ¨ auth_service.py ä¸­æ·»åŠ æœåŠ¡æ–¹æ³•
async def new_auth_feature(self, ...):
    # å®ç°é€»è¾‘
    pass

# 2. åœ¨ auth.py ä¸­æ·»åŠ APIè·¯ç”±
@router.post("/new-feature")
async def new_feature(...):
    return await auth_service.new_auth_feature(...)

# 3. åœ¨å‰ç«¯ auth.ts ä¸­æ·»åŠ æœåŠ¡æ–¹æ³•
export const newFeature = async (...): Promise<...> => {
    // å®ç°é€»è¾‘
};
```

## å®‰å…¨è€ƒè™‘

### ğŸ›¡ï¸ 1. ç”Ÿäº§ç¯å¢ƒé…ç½®
- æ›´æ”¹JWTå¯†é’¥
- ä½¿ç”¨æ›´å¼ºçš„å¯†ç å“ˆå¸Œç®—æ³•ï¼ˆbcryptï¼‰
- é…ç½®HTTPS
- è®¾ç½®CORSç­–ç•¥
- æ·»åŠ è¯·æ±‚é¢‘ç‡é™åˆ¶

### ğŸ” 2. å¯†ç ç­–ç•¥
- å¯†ç å¤æ‚åº¦è¦æ±‚
- å¯†ç è¿‡æœŸç­–ç•¥
- ç™»å½•å¤±è´¥é”å®š
- åŒå› ç´ è®¤è¯

### ğŸ“Š 3. å®¡è®¡æ—¥å¿—
- ç™»å½•æ—¥å¿—
- æ“ä½œæ—¥å¿—
- å®‰å…¨äº‹ä»¶è®°å½•

## æ€»ç»“

âœ… **å®Œæ•´çš„ç”¨æˆ·ç³»ç»Ÿ**: ç™»å½•ã€æ³¨å†Œã€ç”¨æˆ·ç®¡ç†
âœ… **ç°ä»£åŒ–æŠ€æœ¯æ ˆ**: FastAPI + Tortoise + React + Ant Design
âœ… **å®‰å…¨è®¤è¯æœºåˆ¶**: JWTä»¤ç‰Œ + å¯†ç å“ˆå¸Œ
âœ… **å‹å¥½çš„ç”¨æˆ·ç•Œé¢**: å“åº”å¼è®¾è®¡ + äº¤äº’ä¼˜åŒ–
âœ… **é¢„è®¾æµ‹è¯•è´¦æˆ·**: test/test ä¾¿äºæµ‹è¯•
âœ… **å®Œå–„çš„æ–‡æ¡£**: è¯¦ç»†çš„ä½¿ç”¨å’Œå¼€å‘æŒ‡å—

ç”¨æˆ·ç³»ç»Ÿå·²ç»å®Œå…¨é›†æˆåˆ°AIæµ‹è¯•å¹³å°ä¸­ï¼Œæä¾›äº†å®Œæ•´çš„ç”¨æˆ·è®¤è¯å’Œç®¡ç†åŠŸèƒ½ï¼
