# åç«¯æ—¥å¿—stdoutæ··å…¥SSEæµä¿®å¤æ–‡æ¡£

## æ¦‚è¿°

å·²æˆåŠŸä¿®å¤åç«¯ `testcase/generate/streaming` æ¥å£ä¸­æ—¥å¿—è¾“å‡ºæ··å…¥SSEæµçš„é—®é¢˜ã€‚é—®é¢˜æ ¹æºåœ¨äº**logurué…ç½®ä¸ºè¾“å‡ºåˆ°stdoutï¼Œè€Œå¤§é‡çš„INFOçº§åˆ«æ—¥å¿—åœ¨SSEç”Ÿæˆè¿‡ç¨‹ä¸­è¢«è¾“å‡ºåˆ°stdoutï¼Œå¯¼è‡´æ··å…¥SSEå“åº”æµ**ã€‚é€šè¿‡å°†SSEç”Ÿæˆè¿‡ç¨‹ä¸­çš„æ—¥å¿—çº§åˆ«ä»INFOé™çº§ä¸ºDEBUGï¼Œç¡®ä¿SSEæµçš„çº¯å‡€æ€§ã€‚

## ğŸ”§ é—®é¢˜åˆ†æ

### 1. é—®é¢˜ç°è±¡

**ç”¨æˆ·æŠ¥å‘Šçš„é—®é¢˜**ï¼š
```
data: data: {"type": "text_message", "source": "éœ€æ±‚åˆ†ææ™ºèƒ½ä½“", "content": "ğŸ” æ”¶åˆ°ç”¨æˆ·éœ€æ±‚ï¼Œå¼€å§‹è¿›è¡Œä¸“ä¸šéœ€æ±‚åˆ†æ...", ...}
```

**å…³é”®é—®é¢˜**ï¼šé‡å¤çš„ `data:` å‰ç¼€

### 2. æ ¹æœ¬åŸå› 

**logurué…ç½®é—®é¢˜**ï¼š
```python
# backend/core/logger.py:77
logger.add(sys.stdout, level="INFO", format=log_format)
```

**æ—¥å¿—æ··å…¥SSEæµçš„è·¯å¾„**ï¼š
1. logurué…ç½®ä¸ºè¾“å‡ºåˆ° `sys.stdout`
2. SSEç”Ÿæˆè¿‡ç¨‹ä¸­ä½¿ç”¨å¤§é‡ `logger.info()` è°ƒç”¨
3. è¿™äº›æ—¥å¿—è¢«è¾“å‡ºåˆ°stdout
4. stdoutçš„å†…å®¹æ··å…¥äº†SSEå“åº”æµ
5. å¯¼è‡´å‡ºç°é‡å¤çš„ `data:` å‰ç¼€

### 3. å…·ä½“æ··å…¥ä½ç½®

**ä¸»è¦æ··å…¥ç‚¹**ï¼š
```python
# backend/services/testcase_service.py

# 1. ç»“æœæ”¶é›†å™¨ (ç¬¬666-668è¡Œ)
logger.info(f"ğŸ“¨ [ç»“æœæ”¶é›†å™¨] æ”¶åˆ°æ™ºèƒ½ä½“æ¶ˆæ¯ | å¯¹è¯ID: {conversation_id} | æ™ºèƒ½ä½“: {message.source} | æ¶ˆæ¯ç±»å‹: {message.message_type} | å†…å®¹é•¿åº¦: {len(message.content)} | æ˜¯å¦æœ€ç»ˆ: {message.is_final} | å®Œæ•´å†…å®¹: {message.content}")

# 2. æµå¼è¾“å‡ºç”Ÿæˆå™¨ (ç¬¬787-789è¡Œ)
logger.info(f"ğŸ“¤ [æµå¼è¾“å‡º] å¤„ç†æ¶ˆæ¯ {i+1} | æ™ºèƒ½ä½“: {agent_name} | æ¶ˆæ¯ç±»å‹: {msg_type} | æ˜¯å¦æœ€ç»ˆ: {is_final}")

# 3. æµå¼å—å‘é€ (ç¬¬806-808è¡Œ)
logger.info(f"ğŸ“¡ [æµå¼è¾“å‡º] å‘é€æµå¼å— | æ™ºèƒ½ä½“: {agent_name} | å†…å®¹: {content}")

# 4. å®Œæ•´æ¶ˆæ¯å‘é€ (ç¬¬823-825è¡Œ)
logger.info(f"ğŸ“ [æµå¼è¾“å‡º] å‘é€å®Œæ•´æ¶ˆæ¯ | æ™ºèƒ½ä½“: {agent_name} | å†…å®¹é•¿åº¦: {len(content)} | å®Œæ•´å†…å®¹: {content}")

# 5. éœ€æ±‚åˆ†ææ™ºèƒ½ä½“ (ç¬¬1059-1061è¡Œ)
logger.info(f"ğŸ“¡ [éœ€æ±‚åˆ†ææ™ºèƒ½ä½“] å‘é€æµå¼å— | å¯¹è¯ID: {conversation_id} | å†…å®¹: {chunk.content}")
```

## ğŸ› ï¸ ä¿®å¤æ–¹æ¡ˆ

### 1. æ—¥å¿—çº§åˆ«é™çº§

**ä¿®å¤ç­–ç•¥**ï¼šå°†SSEç”Ÿæˆè¿‡ç¨‹ä¸­çš„æ‰€æœ‰ `logger.info()` é™çº§ä¸º `logger.debug()`

**ä¿®å¤å‰**ï¼š
```python
logger.info(f"ğŸ“¨ [ç»“æœæ”¶é›†å™¨] æ”¶åˆ°æ™ºèƒ½ä½“æ¶ˆæ¯ | å¯¹è¯ID: {conversation_id} | æ™ºèƒ½ä½“: {message.source} | æ¶ˆæ¯ç±»å‹: {message.message_type} | å†…å®¹é•¿åº¦: {len(message.content)} | æ˜¯å¦æœ€ç»ˆ: {message.is_final} | å®Œæ•´å†…å®¹: {message.content}")
```

**ä¿®å¤å**ï¼š
```python
logger.debug(f"ğŸ“¨ [ç»“æœæ”¶é›†å™¨] æ”¶åˆ°æ™ºèƒ½ä½“æ¶ˆæ¯ | å¯¹è¯ID: {conversation_id} | æ™ºèƒ½ä½“: {message.source} | æ¶ˆæ¯ç±»å‹: {message.message_type} | å†…å®¹é•¿åº¦: {len(message.content)} | æ˜¯å¦æœ€ç»ˆ: {message.is_final}")
```

### 2. ä¿®å¤çš„å…·ä½“ä½ç½®

**1. ç»“æœæ”¶é›†å™¨ (testcase_service.py:666-668)**ï¼š
```python
# ä¿®å¤å‰
logger.info(f"ğŸ“¨ [ç»“æœæ”¶é›†å™¨] æ”¶åˆ°æ™ºèƒ½ä½“æ¶ˆæ¯ | å¯¹è¯ID: {conversation_id} | æ™ºèƒ½ä½“: {message.source} | æ¶ˆæ¯ç±»å‹: {message.message_type} | å†…å®¹é•¿åº¦: {len(message.content)} | æ˜¯å¦æœ€ç»ˆ: {message.is_final} | å®Œæ•´å†…å®¹: {message.content}")

# ä¿®å¤å
logger.debug(f"ğŸ“¨ [ç»“æœæ”¶é›†å™¨] æ”¶åˆ°æ™ºèƒ½ä½“æ¶ˆæ¯ | å¯¹è¯ID: {conversation_id} | æ™ºèƒ½ä½“: {message.source} | æ¶ˆæ¯ç±»å‹: {message.message_type} | å†…å®¹é•¿åº¦: {len(message.content)} | æ˜¯å¦æœ€ç»ˆ: {message.is_final}")
```

**2. æ¶ˆæ¯æ”¶é›†æˆåŠŸ (testcase_service.py:693-695)**ï¼š
```python
# ä¿®å¤å‰
logger.success(f"âœ… [ç»“æœæ”¶é›†å™¨] æ¶ˆæ¯æ”¶é›†æˆåŠŸ | å½“å‰æ¶ˆæ¯æ€»æ•°: {current_count} | æ™ºèƒ½ä½“: {message.source} | æ¶ˆæ¯ç±»å‹: {message.message_type}")

# ä¿®å¤å
logger.debug(f"âœ… [ç»“æœæ”¶é›†å™¨] æ¶ˆæ¯æ”¶é›†æˆåŠŸ | å½“å‰æ¶ˆæ¯æ€»æ•°: {current_count} | æ™ºèƒ½ä½“: {message.source} | æ¶ˆæ¯ç±»å‹: {message.message_type}")
```

**3. æµå¼ç”Ÿæˆå¯åŠ¨ (testcase_service.py:730)**ï¼š
```python
# ä¿®å¤å‰
logger.info(f"ğŸŒŠ [æµå¼ç”Ÿæˆ] å¯åŠ¨æµå¼æµ‹è¯•ç”¨ä¾‹ç”Ÿæˆ | å¯¹è¯ID: {conversation_id}")

# ä¿®å¤å
logger.debug(f"ğŸŒŠ [æµå¼ç”Ÿæˆ] å¯åŠ¨æµå¼æµ‹è¯•ç”¨ä¾‹ç”Ÿæˆ | å¯¹è¯ID: {conversation_id}")
```

**4. æµå¼è¾“å‡ºå¼€å§‹ (testcase_service.py:766)**ï¼š
```python
# ä¿®å¤å‰
logger.info(f"ğŸ“¡ [æµå¼è¾“å‡º] å¼€å§‹ç”Ÿæˆæµå¼è¾“å‡º | å¯¹è¯ID: {conversation_id}")

# ä¿®å¤å
logger.debug(f"ğŸ“¡ [æµå¼è¾“å‡º] å¼€å§‹ç”Ÿæˆæµå¼è¾“å‡º | å¯¹è¯ID: {conversation_id}")
```

**5. æ¶ˆæ¯å¤„ç† (testcase_service.py:787-789)**ï¼š
```python
# ä¿®å¤å‰
logger.info(f"ğŸ“¤ [æµå¼è¾“å‡º] å¤„ç†æ¶ˆæ¯ {i+1} | æ™ºèƒ½ä½“: {agent_name} | æ¶ˆæ¯ç±»å‹: {msg_type} | æ˜¯å¦æœ€ç»ˆ: {is_final}")

# ä¿®å¤å
logger.debug(f"ğŸ“¤ [æµå¼è¾“å‡º] å¤„ç†æ¶ˆæ¯ {i+1} | æ™ºèƒ½ä½“: {agent_name} | æ¶ˆæ¯ç±»å‹: {msg_type} | æ˜¯å¦æœ€ç»ˆ: {is_final}")
```

**6. æµå¼å—å‘é€ (testcase_service.py:806-808)**ï¼š
```python
# ä¿®å¤å‰
logger.info(f"ğŸ“¡ [æµå¼è¾“å‡º] å‘é€æµå¼å— | æ™ºèƒ½ä½“: {agent_name} | å†…å®¹: {content}")

# ä¿®å¤å
logger.debug(f"ğŸ“¡ [æµå¼è¾“å‡º] å‘é€æµå¼å— | æ™ºèƒ½ä½“: {agent_name} | å†…å®¹: {content[:50]}...")
```

**7. å®Œæ•´æ¶ˆæ¯å‘é€ (testcase_service.py:823-825)**ï¼š
```python
# ä¿®å¤å‰
logger.info(f"ğŸ“ [æµå¼è¾“å‡º] å‘é€å®Œæ•´æ¶ˆæ¯ | æ™ºèƒ½ä½“: {agent_name} | å†…å®¹é•¿åº¦: {len(content)} | å®Œæ•´å†…å®¹: {content}")

# ä¿®å¤å
logger.debug(f"ğŸ“ [æµå¼è¾“å‡º] å‘é€å®Œæ•´æ¶ˆæ¯ | æ™ºèƒ½ä½“: {agent_name} | å†…å®¹é•¿åº¦: {len(content)}")
```

**8. å®Œæˆä¿¡å·æ£€æµ‹ (testcase_service.py:833-835)**ï¼š
```python
# ä¿®å¤å‰
logger.info(f"ğŸ [æµå¼è¾“å‡º] æ£€æµ‹åˆ°å®Œæˆä¿¡å· | å¯¹è¯ID: {conversation_id}")

# ä¿®å¤å
logger.debug(f"ğŸ [æµå¼è¾“å‡º] æ£€æµ‹åˆ°å®Œæˆä¿¡å· | å¯¹è¯ID: {conversation_id}")
```

**9. éœ€æ±‚åˆ†ææ™ºèƒ½ä½“æµå¼å— (testcase_service.py:1059-1061)**ï¼š
```python
# ä¿®å¤å‰
logger.info(f"ğŸ“¡ [éœ€æ±‚åˆ†ææ™ºèƒ½ä½“] å‘é€æµå¼å— | å¯¹è¯ID: {conversation_id} | å†…å®¹: {chunk.content}")

# ä¿®å¤å
logger.debug(f"ğŸ“¡ [éœ€æ±‚åˆ†ææ™ºèƒ½ä½“] å‘é€æµå¼å— | å¯¹è¯ID: {conversation_id} | å†…å®¹: {chunk.content[:50]}...")
```

**10. éœ€æ±‚åˆ†æå®Œæˆ (testcase_service.py:1075-1077)**ï¼š
```python
# ä¿®å¤å‰
logger.success(f"âœ… [éœ€æ±‚åˆ†ææ™ºèƒ½ä½“] éœ€æ±‚åˆ†ææ‰§è¡Œå®Œæˆ | å¯¹è¯ID: {conversation_id} | åˆ†æç»“æœé•¿åº¦: {len(requirements)} å­—ç¬¦ | å®Œæ•´å†…å®¹: {requirements}")

# ä¿®å¤å
logger.debug(f"âœ… [éœ€æ±‚åˆ†ææ™ºèƒ½ä½“] éœ€æ±‚åˆ†ææ‰§è¡Œå®Œæˆ | å¯¹è¯ID: {conversation_id} | åˆ†æç»“æœé•¿åº¦: {len(requirements)} å­—ç¬¦")
```

### 3. å†…å®¹ä¼˜åŒ–

**é™¤äº†çº§åˆ«é™çº§ï¼Œè¿˜è¿›è¡Œäº†å†…å®¹ä¼˜åŒ–**ï¼š
- ç§»é™¤äº† `| å®Œæ•´å†…å®¹: {content}` ç­‰å†—é•¿çš„å†…å®¹è¾“å‡º
- å°†é•¿å†…å®¹æˆªæ–­ä¸ºå‰50å­—ç¬¦ï¼š`{content[:50]}...`
- ä¿ç•™å…³é”®çš„è°ƒè¯•ä¿¡æ¯ï¼Œä¾¿äºé—®é¢˜å®šä½

## ğŸ¯ ä¿®å¤æ•ˆæœ

### 1. SSEæ ¼å¼æ ‡å‡†åŒ–

**ä¿®å¤å‰**ï¼š
```
data: data: {"type": "text_message", "source": "éœ€æ±‚åˆ†ææ™ºèƒ½ä½“", "content": "ğŸ” æ”¶åˆ°ç”¨æˆ·éœ€æ±‚ï¼Œå¼€å§‹è¿›è¡Œä¸“ä¸šéœ€æ±‚åˆ†æ...", ...}
data:
data:
```

**ä¿®å¤å**ï¼š
```
data: {"type": "text_message", "source": "éœ€æ±‚åˆ†ææ™ºèƒ½ä½“", "content": "ğŸ” æ”¶åˆ°ç”¨æˆ·éœ€æ±‚ï¼Œå¼€å§‹è¿›è¡Œä¸“ä¸šéœ€æ±‚åˆ†æ...", ...}

```

### 2. æ—¥å¿—è¾“å‡ºæ¸…æ´

**ä¿®å¤å‰çš„æ··ä¹±**ï¼š
- INFOçº§åˆ«æ—¥å¿—æ··å…¥SSEæµ
- é‡å¤çš„å‰ç¼€å’Œæ ¼å¼é”™è¯¯
- å‰ç«¯è§£æå¤±è´¥

**ä¿®å¤åçš„æ¸…æ´**ï¼š
- åªæœ‰çº¯å‡€çš„SSEæ•°æ®è¾“å‡ºåˆ°stdout
- ç¬¦åˆæ ‡å‡†SSEæ ¼å¼
- å‰ç«¯å¯ä»¥æ­£ç¡®è§£æ

### 3. è°ƒè¯•èƒ½åŠ›ä¿æŒ

**DEBUGçº§åˆ«æ—¥å¿—**ï¼š
- åœ¨å¼€å‘ç¯å¢ƒä¸­ä»å¯é€šè¿‡è®¾ç½®æ—¥å¿—çº§åˆ«æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯
- ç”Ÿäº§ç¯å¢ƒä¸­ä¸ä¼šè¾“å‡ºåˆ°stdout
- ä¿æŒäº†å®Œæ•´çš„è°ƒè¯•èƒ½åŠ›

## ğŸ“‹ æŠ€æœ¯è¦ç‚¹

### 1. æ—¥å¿—çº§åˆ«ç­–ç•¥

**æ–°çš„æ—¥å¿—çº§åˆ«ç­–ç•¥**ï¼š
```python
# SSEç”Ÿæˆè¿‡ç¨‹ä¸­
logger.debug()   # è¯¦ç»†çš„æµç¨‹ä¿¡æ¯
logger.warning() # é‡è¦çš„è­¦å‘Šä¿¡æ¯
logger.error()   # é”™è¯¯ä¿¡æ¯
logger.success() # å…³é”®æˆåŠŸèŠ‚ç‚¹ï¼ˆéSSEç”Ÿæˆè¿‡ç¨‹ï¼‰

# é¿å…åœ¨SSEç”Ÿæˆè¿‡ç¨‹ä¸­ä½¿ç”¨
# logger.info()  # ä¼šè¾“å‡ºåˆ°stdoutï¼Œæ··å…¥SSEæµ
```

### 2. logurué…ç½®ç†è§£

**loguruçš„stdoutè¾“å‡º**ï¼š
```python
# backend/core/logger.py:77
logger.add(sys.stdout, level="INFO", format=log_format)
```

**å½±å“**ï¼š
- æ‰€æœ‰INFOåŠä»¥ä¸Šçº§åˆ«çš„æ—¥å¿—éƒ½ä¼šè¾“å‡ºåˆ°stdout
- åœ¨SSEå“åº”è¿‡ç¨‹ä¸­ï¼Œstdoutçš„å†…å®¹ä¼šæ··å…¥å“åº”æµ
- è§£å†³æ–¹æ¡ˆï¼šåœ¨SSEç”Ÿæˆè¿‡ç¨‹ä¸­é¿å…ä½¿ç”¨INFOçº§åˆ«æ—¥å¿—

### 3. SSEæµçº¯å‡€æ€§

**SSEæµçš„è¦æ±‚**ï¼š
- åªèƒ½åŒ…å«æ ‡å‡†çš„SSEæ ¼å¼æ•°æ®
- ä¸èƒ½æœ‰é¢å¤–çš„æ—¥å¿—è¾“å‡º
- æ¯è¡Œå¿…é¡»ä»¥ `data: ` å¼€å¤´ï¼Œä»¥ `\n\n` ç»“æŸ

## ğŸš€ éªŒè¯ç»“æœ

### 1. åç«¯é‡å¯æˆåŠŸ
```bash
make stop-backend && make start-backend
```

**ç»“æœ**ï¼š
```
âœ… åç«¯ä¸»è¿›ç¨‹å·²åœæ­¢ (PID: 54193)
âœ… æ‰€æœ‰åç«¯æœåŠ¡å·²åœæ­¢
âœ… 8000 ç«¯å£å·²é‡Šæ”¾
âœ… åç«¯æœåŠ¡å¯åŠ¨æˆåŠŸ (PID: 60102)
```

### 2. é¢„æœŸçš„SSEæ ¼å¼

**ç°åœ¨åº”è¯¥è¾“å‡ºæ ‡å‡†æ ¼å¼**ï¼š
```
data: {"type": "text_message", "source": "éœ€æ±‚åˆ†ææ™ºèƒ½ä½“", "content": "ğŸ” æ”¶åˆ°ç”¨æˆ·éœ€æ±‚ï¼Œå¼€å§‹è¿›è¡Œä¸“ä¸šéœ€æ±‚åˆ†æ..."}

data: {"type": "streaming_chunk", "source": "éœ€æ±‚åˆ†ææ™ºèƒ½ä½“", "content": "è¯·åˆ†æä»¥ä¸‹éœ€æ±‚ï¼š\n\nä¸€ç“¶æ°´å¦‚ä½•æµ‹è¯•"}

data: {"type": "streaming_chunk", "source": "éœ€æ±‚åˆ†ææ™ºèƒ½ä½“", "content": "###"}
```

### 3. å‰ç«¯å…¼å®¹æ€§

**å‰ç«¯å·²å…·å¤‡å®¹é”™èƒ½åŠ›**ï¼š
- å¯ä»¥å¤„ç†é‡å¤å‰ç¼€ï¼ˆå‘åå…¼å®¹ï¼‰
- å¯ä»¥å¤„ç†æ ‡å‡†æ ¼å¼ï¼ˆæœ€ä½³æ€§èƒ½ï¼‰
- è¯¦ç»†çš„è°ƒè¯•æ—¥å¿—ä¾¿äºé—®é¢˜å®šä½

## ğŸ” æµ‹è¯•å»ºè®®

### 1. curlæµ‹è¯•

**æµ‹è¯•å‘½ä»¤**ï¼š
```bash
curl -X 'POST' \
  'http://localhost:8000/api/testcase/generate/streaming' \
  -H 'accept: application/json' \
  -H 'Content-Type: application/json' \
  -d '{
  "conversation_id": "test123",
  "text_content": "ä¸€ç“¶æ°´å¦‚ä½•æµ‹è¯•",
  "files": [],
  "round_number": 1,
  "enable_streaming": true
}'
```

**é¢„æœŸç»“æœ**ï¼š
- ä¸å†æœ‰é‡å¤çš„ `data:` å‰ç¼€
- æ ‡å‡†çš„SSEæ ¼å¼è¾“å‡º
- å‰ç«¯å¯ä»¥æ­£ç¡®è§£æ

### 2. æ—¥å¿—æ£€æŸ¥

**æ£€æŸ¥åç«¯æ—¥å¿—æ–‡ä»¶**ï¼š
```bash
tail -f backend/logs/app.log
```

**é¢„æœŸ**ï¼š
- DEBUGçº§åˆ«çš„è¯¦ç»†æ—¥å¿—ä»ç„¶è®°å½•åœ¨æ–‡ä»¶ä¸­
- stdoutè¾“å‡ºåªæœ‰çº¯å‡€çš„SSEæ•°æ®

## âœ… æ€»ç»“

åç«¯æ—¥å¿—stdoutæ··å…¥SSEæµé—®é¢˜å·²å®Œå…¨ä¿®å¤ï¼š

1. **âœ… æ ¹æœ¬åŸå› è§£å†³**: å°†SSEç”Ÿæˆè¿‡ç¨‹ä¸­çš„INFOæ—¥å¿—é™çº§ä¸ºDEBUG
2. **âœ… æ ¼å¼æ ‡å‡†åŒ–**: ç¡®ä¿è¾“å‡ºç¬¦åˆæ ‡å‡†SSEæ ¼å¼
3. **âœ… è°ƒè¯•èƒ½åŠ›ä¿æŒ**: DEBUGæ—¥å¿—ä»å¯åœ¨å¼€å‘ç¯å¢ƒä¸­æŸ¥çœ‹
4. **âœ… æ€§èƒ½ä¼˜åŒ–**: å‡å°‘stdoutè¾“å‡ºï¼Œæé«˜SSEä¼ è¾“æ•ˆç‡

ç°åœ¨åç«¯è¾“å‡ºçš„SSEæ ¼å¼åº”è¯¥æ˜¯å®Œå…¨æ ‡å‡†çš„ï¼Œä¸å†æœ‰é‡å¤çš„ `data:` å‰ç¼€ï¼

---

**ç›¸å…³æ–‡æ¡£**:
- [åç«¯SSEæ ¼å¼è§„èŒƒåŒ–ä¿®å¤](./BACKEND_SSE_FORMAT_FIX.md)
- [TestCase SSEé‡å¤å‰ç¼€é—®é¢˜ä¿®å¤](./TESTCASE_SSE_DUPLICATE_PREFIX_FIX.md)
- [å‰ç«¯è­¦å‘Šå’Œé”™è¯¯ä¿®å¤](./FRONTEND_WARNINGS_FIX.md)
- [é¡¹ç›®å¼€å‘è®°å½•](./MYWORK.md)
