

## ç”¨ä¾‹è¯„å®¡æ™ºèƒ½ä½“åˆæ­¥æ­å»º(2025å¹´06æœˆ08æ—¥)

ä¸Šä¸€æ¬¡å¼€å‘äº†ä¸€ä¸ªç®€å•çš„AIå¯¹è¯æ¨¡å—,æœ‰ä¸€äº›å¾…å¼€å‘çš„å°æ¨¡å—æ²¡æœ‰å¼€å‘å®Œæˆ(æ–‡ä»¶ä¸Šä¼ ,å†å²è®°å½•),è¿™äº›æ”¾åœ¨åé¢ä¼˜åŒ–

è¿™ä¸€æ¬¡,æˆ‘ä»¬æ¥å¼€å‘ä¸€ä¸ªç”¨ä¾‹è¯„ç”Ÿæˆæ™ºèƒ½ä½“,ä¸»è¦çš„éœ€æ±‚å¯ä»¥ç®€è¿°ä¸º:

1. æ”¯æŒç”¨æˆ·ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶æˆ–è€…æ–‡å­—,ç„¶åå¯¹å…¶è¿›è¡Œè§£æ,ç»™å‡ºç›¸åº”çš„æµ‹è¯•ç”¨ä¾‹
2. ä¹‹åAIå¯¹ç”¨ä¾‹è¿›è¡Œè¯„å®¡,ç„¶åä¿®æ”¹,å‰ç«¯å±•ç¤ºç”¨ä¾‹
3. ç”¨æˆ·ç»™å‡ºåé¦ˆå’Œæ˜¯å¦åŒæ„,æœ€å¤šä¸‰æ¬¡æ„è§
4. æœ€ç»ˆç»™å‡ºç”¨ä¾‹,è¿”å›åˆ°å‰ç«¯

è¦æ±‚:æ˜ç¡®æ˜¾ç¤ºè¾“å‡ºçš„å†…å®¹æ˜¯å“ªä¸ªæ™ºèƒ½ä½“å‘å‡ºçš„ï¼ˆåšæˆæ—¶é—´è½´æˆ–è€…æŠ˜å æ•ˆæœï¼‰

ä¼˜åŒ–: åæœŸæ”¯æŒæŠŠç›¸å…³å†…å®¹è¿›è¡Œè½åº“



å’ŒAIè¿›è¡Œå¯¹è¯

```
åœ¨å½“å‰ä»£ç çš„åŸºç¡€ä¸Š,å®ŒæˆAIç”¨ä¾‹æ¨¡å—å¼€å‘:
1. å‰ç«¯ç•Œé¢ï¼Œç•Œé¢é£æ ¼å‚è€ƒ Geminiï¼Œç•Œé¢é£æ ¼è¦ç‚«é…·ï¼Œä»£ç æ”¾åˆ°frontendç›®å½•
2. åç«¯åŸºäºFastapiæä¾›æ¥å£ï¼Œä½¿ç”¨sseåè®®è¿›è¡Œæµå¼è¾“å‡ºï¼Œä»£ç æ”¾åˆ°backendç›®å½•
3. æ™ºèƒ½ä½“å¼€å‘æŠ€æœ¯:
	ä½¿ç”¨autogen0.5.7 å®ç°ä¸å¤§æ¨¡å‹å¯¹è¯,å…·ä½“çš„ä¾‹å­å¯ä»¥å‚è€ƒ:
	https://microsoft.github.io/autogen/stable/user-guide/agentchat-user-guide/tutorial/teams.html
	ä½¿ç”¨RoundRobinGroupChatå’ŒSingleThreadedAgentRuntimeæ¥å®ç°
	æœ¬åœ°demoå‚è€ƒ:examples/multi_agent.py examples/team.py examples/topic.py examples/agent_call_tools.py

4. ä¸šåŠ¡é€»è¾‘:
	å‰ç«¯æ”¯æŒä¸Šä¼ æ–‡ä»¶\ç…§ç‰‡\æ–‡æœ¬,å‘é€ç»™éœ€æ±‚è·å–æ™ºèƒ½ä½“
	éœ€æ±‚è·å–æ™ºèƒ½ä½“å°†å†…å®¹è§£æåå‘é€ç»™ç”¨ä¾‹ç”Ÿæˆæ™ºèƒ½ä½“
	å¤šæ¬¡å’Œç”¨æˆ·äº¤æµ(æœ€å¤šä¸‰æ¬¡),ç›´åˆ°ç”¨æˆ·åŒæ„
	å°†ç»“æœç»“æ„åŒ–å±•ç¤ºç»™ç”¨æˆ·,ä¹‹åç»“æŸ
è¦æ±‚:æ˜ç¡®æ˜¾ç¤ºè¾“å‡ºçš„å†…å®¹æ˜¯å“ªä¸ªæ™ºèƒ½ä½“å‘å‡ºçš„ï¼ˆåšæˆæ—¶é—´è½´æˆ–è€…æŠ˜å æ•ˆæœï¼‰


```



![image-20250608170838776](assets/image-20250608170838776.png)

AIè§£è¯»åçš„é€»è¾‘:

![image-20250608171204234](assets/image-20250608171204234.png)



å¯åŠ¨AIç”Ÿæˆçš„ä»£ç 

![image-20250608172947624](assets/image-20250608172947624.png)



### ä¼˜åŒ–

å½“å‰æŠŠAIå¯¹è¯æ¨¡å—å¼„æ²¡äº†,éœ€è¦ä¼˜å…ˆä¿®å¤è¯¥é—®é¢˜

ç»§ç»­å’ŒAIè¿›è¡Œå¯¹è¯

```
AIå¯¹è¯æ¨¡å—å’ŒAIç”¨ä¾‹ç”Ÿæˆæ¨¡å—æ˜¯ä¸¤ä¸ªç‹¬ç«‹çš„æ¨¡å—,è¯·ä¸è¦æ··åœ¨ä¸€èµ·,è¯·è¿˜åŸä¹‹å‰çš„ä»£ç ,ç„¶åé‡æ–°å®Œæˆä¸Šè¿°åŠŸèƒ½,åœ¨é¦–é¡µæœ‰ä¸¤ä¸ªåŠŸèƒ½çš„å…¥å£
```

![image-20250608173358739](assets/image-20250608173358739.png)



### ä¼˜åŒ–

![image-20250608174650268](assets/image-20250608174650268.png)

ç”¨ä¾‹ç”Ÿæˆç•Œé¢

![image-20250608181048224](assets/image-20250608181048224.png)

å¦‚ä¸Šçš„ç”¨ä¾‹ç”Ÿæˆç•Œé¢è¿˜æ˜¯æ¯”è¾ƒéš¾çœ‹çš„

å¹¶ä¸”æˆ‘çœ‹äº†æœåŠ¡ç«¯çš„ä»£ç 

å’Œç”¨æˆ·å¯¹è¯ä¸”å’Œç»ˆæ­¢çš„éƒ¨åˆ†æ²¡æœ‰ä½¿ç”¨Autogençš„çš„ä»£ç ,å¦‚ä¸‹

æˆ‘åº”è¯¥å‘Šè¯‰ä»–å…·ä½“ä½¿ç”¨Autogençš„å“ªä¸ªç›¸å…³ä»£ç ,ä¸”ç»™åˆ°ä¸€ä¸ªdemo

![image-20250608181251080](assets/image-20250608181251080.png)

### ä¼˜åŒ–

ç°åœ¨ä¸€ä¸ªä¸€ä¸ªä¼˜åŒ–,é¦–å…ˆä¼˜åŒ–ä¸€ä¸‹å‰ç«¯çš„é¡µé¢

ç»§ç»­å’ŒAIè¿›è¡Œå¯¹è¯

```
å‰ç«¯ä¼˜åŒ–,è¿›å…¥å¯¹åº”æ¨¡å—å:æœ€å¥½æœ‰ä¸€ä¸ªå·¦ä¾§çš„å¯¼èˆªæ ,å¯ä»¥æŒ‡å®šè¿›å…¥åˆ°å¯¹åº”çš„æ¨¡å—,ä¸”å¯¼èˆªæ å¯ä»¥æŠ˜å åˆ°å·¦ä¾§
```

![image-20250608181715280](assets/image-20250608181715280.png)



![image-20250608182842901](assets/image-20250608182842901.png)



ç”Ÿæˆåçš„ä»£ç ,é…è‰²ä¸Šæˆ‘æ„Ÿè§‰è¿˜æœ‰ä¸å°‘çš„é—®é¢˜,ä¸”æŠ˜å çš„æŒ‰é’®æˆ‘æƒ³å›ºå®šåˆ°é¡µé¢çš„æœ€ä¸‹è§’,ç»§ç»­ä¼˜åŒ–

![image-20250608183127182](assets/image-20250608183127182.png)

### ä¼˜åŒ–

ç»§ç»­å’ŒAIè¿›è¡Œå¯¹è¯

```
1. ä¾§è¾¹æ çš„é…è‰²å’Œä¸»è¦å†…å®¹åŒºçš„é¢œè‰²å·®å¼‚å¾ˆå¤§,ä¸å¤ªç¾è§‚,è¯·ä¿®å¤,é¡µé¢å°½å¯èƒ½çš„ç¾è§‚ç®€çº¦é«˜å¤§ä¸Š
2. æŠ˜å åçš„æŒ‰é’®æ”¾åœ¨é¡µé¢çš„æœ€ä¸‹è§’,ä¸ç®¡å¦‚ä½•æ»‘åŠ¨,å§‹ç»ˆå›ºå®šåœ¨æœ€ä¸‹è§’
3. æŠ˜å åAIæ¨¡å—çš„æ ‡é¢˜è¿˜èƒ½çœ‹åˆ°,ä¸ç¾è§‚
4. å¢åŠ ä¸€ä¸ªä¸Šæ–¹å¯¼èˆªæ ,åœ¨å¯¼èˆªæ çš„å³ä¾§ä¸ºæˆ‘çš„gitä»£ç ä»“åº“,é“¾æ¥åœ°å€ä¸º:https://github.com/ljxpython/aitestlabå’Œç”¨æˆ·çš„å¤´åƒ

```

![image-20250608184010606](assets/image-20250608184010606.png)



![image-20250608185745611](assets/image-20250608185745611.png)

### ä¼˜åŒ–

ä¼˜åŒ–åçš„é…è‰²å¦‚ä¸‹,å˜å¾—æ›´åŠ éš¾çœ‹äº†,ä¸”ä¾§è¾¹æ çš„æŠ˜å åŠŸèƒ½ç”Ÿæˆçš„ä¹Ÿä¸å¥½

![image-20250608185925514](assets/image-20250608185925514.png)

ç»§ç»­å’ŒAIè¿›è¡Œå¯¹è¯ä¼˜åŒ–

```
æŠ˜å ä¾§è¾¹æ çš„æŒ‰é’®éœ€è¦å›ºå®šæ”¾åˆ°é¡µé¢çš„ä¾§è¾¹æ çš„æœ€ä¸‹é¢
æ•´ä½“çš„é…è‰²è¦è¿›è¡Œç»Ÿä¸€,è¦é«˜å¤§ä¸Šä¸”ç¾è§‚
ç”¨æˆ·çš„åŠŸèƒ½æš‚æœªå®ç°,æš‚æ—¶å…ˆå–æ¶ˆè¯¥æŒ‰é’®
å¯¼èˆªæ çš„AIæµ‹è¯•å¹³å°æ ‡é¢˜å’Œä¾§è¾¹æ çš„æ ‡é¢˜å†…å®¹é‡å¤äº†
```

![image-20250608190428018](assets/image-20250608190428018.png)



### ä¼˜åŒ–

ä¸Šè¿°ä¼˜åŒ–åçš„å‰ç«¯å±•ç¤ºå¦‚ä¸‹:

![image-20250608192043435](assets/image-20250608192043435.png)



çœ‹ç€è¿˜æ˜¯å¾ˆéš¾çœ‹,éœ€è¦ç»§ç»­ä¼˜åŒ–



å‚è€ƒæˆ‘ä¹‹å‰è®¾è®¡çš„é¡µé¢,è®©AIå¯¹åº”ç€ç”Ÿæˆ

![image-20250608191931038](assets/image-20250608191931038.png)

```
è¯·å‚è€ƒå›¾ç‰‡ä¸­çš„å¹³å°è¿›è¡Œè®¾è®¡
é£æ ¼ç›¸ä¼¼
æŠ˜å æŒ‰é’®è·Ÿéšä¾§è¾¹æ ,æŒ‰ç…§å›¾ä¸­å±•ç¤ºçš„ç”Ÿæˆ
ä¾§è¾¹æ é€‰ä¸­å,ä¸è¦å˜æˆæ·±è‰²
```

![image-20250608192430367](assets/image-20250608192430367.png)

![image-20250608193139414](assets/image-20250608193139414.png)



![image-20250608193637580](assets/image-20250608193637580.png)



### ä¼˜åŒ–



```
ä¾§è¾¹æ ä¼˜åŒ–:
	1. ä¾§è¾¹æ çš„AIå›¾æ ‡æ”¾åˆ°å¯¼èˆªæ æ ‡é¢˜å·¦ä¾§,ä¾§è¾¹æ çš„æ ‡é¢˜å»æ‰
	2. ä¾§è¾¹æ  ä¸€çº§æ ‡é¢˜äºŒçº§æ ‡é¢˜å¢åŠ æŠ˜å åŠŸèƒ½
	3. å½“é¡µé¢æ»‘åŠ¨æ—¶,ä¾§è¾¹æ ä¸éšè¿™é¡µé¢æ»‘åŠ¨

```

![image-20250608195120247](assets/image-20250608195120247.png)



![image-20250608200243610](assets/image-20250608200243610.png)





### ä¼˜åŒ–

![image-20250608200100810](assets/image-20250608200100810.png)

ä¼˜åŒ–å,å¯ä»¥å‘ç°å­˜åœ¨ä¸€ä¸ªå°çš„é—®é¢˜,å¯¼èˆªæ ä¼šè·Ÿç€ç§»åŠ¨,éœ€è¦ä¼˜åŒ–

ç»§ç»­å’ŒAIè¿›è¡Œå¯¹è¯

```
å¯¼èˆªæ ä¼˜åŒ–:
	å½“é¡µé¢æ»‘åŠ¨æ—¶,ä¾§è¾¹æ ä¸éšé¡µé¢æ»‘åŠ¨
```



![image-20250608201503761](assets/image-20250608201503761.png)



![image-20250608201423632](assets/image-20250608201423632.png)



### ä¼˜åŒ–

å‘ç°åˆ°ç°åœ¨è¿˜æ²¡æœ‰ä¸€ä¸ªç”¨æˆ·ç•Œé¢,ç›´æ¥ä½¿ç”¨AIè®¾è®¡ä¸€ä¸ªå‰ç«¯å’Œåç«¯åŠç”¨æˆ·ç³»ç»Ÿ

ç»§ç»­å’ŒAIå¯¹è¯

```
è®¾è®¡å¹³å°ç”¨æˆ·ç³»ç»Ÿ:
	1. å®Œæˆå‰ç«¯ç™»å½•é¡µé¢
	2. åç«¯fastapi+Tortoise+Aerich
	3. æ•°æ®åº“æš‚æ—¶é€‰ç”¨sqlite,é¢„å…ˆç”Ÿæˆä¸€ä¸ªè´¦æˆ·:test å¯†ç  testçš„ç”¨æˆ·,ç™»å½•é¡µé¢æç¤ºè¯¥ç”¨æˆ·åå’Œå¯†ç 
	4. å¯¼èˆªæ å³ä¾§å¢åŠ ç”¨æˆ·çš„å›¾æ ‡,æ”¾åˆ°è¯¥å›¾æ ‡ä¸Š,å¯ä»¥ä¸‹æ‹‰è¿›å…¥ç”¨æˆ·è¯¦æƒ…ç•Œé¢,å¯ä»¥ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯

```





ä¸­é€”æˆ‘çœ‹AIå¡åœ¨å®‰è£…ç”¨ä¾‹çš„åœ°æ–¹

æˆ‘æ‰‹åŠ¨æ‰§è¡Œå®‰è£…

```
 poetry add tortoise-orm aerich passlib python-jose bcrypt
```



![image-20250608205350768](assets/image-20250608205350768.png)



![image-20250608205314474](assets/image-20250608205314474.png)



![image-20250608212104723](assets/image-20250608212104723.png)

### è§£å†³é—®é¢˜

æ‰§è¡Œä»£ç ä¼šå‘ç°æŠ¥é”™

backend/core/security.py

è¿™é‡Œçš„é—®é¢˜æ˜¯æ²¡æœ‰æ ¹æ®`backend/conf` ä¸­å¼•å…¥ç¯å¢ƒå˜é‡

![image-20250608212137938](assets/image-20250608212137938.png)

ç»§ç»­å’ŒAIè¿›è¡Œå¯¹è¯

```
1. è¯·ä¿®å¤backend/core/security.pyä¸­çš„from backend.core.config import settingsé—®é¢˜,æˆ‘å¸Œæœ›ä½¿ç”¨backend/conf/config.pyçš„settingsæ¥å®Œæˆç¯å¢ƒå˜é‡çš„ä½¿ç”¨,å¯ä»¥æŸ¥é˜…ç›®å½•ä¸‹å…¶ä»–ä»£ç å¯¹å…¶çš„ä½¿ç”¨
2. æ•´ç†docsç›®å½•ä¸‹çš„markdownæ–‡ä»¶,ä½¿å…¶è°ƒç†æ¸…æ™°
```



![image-20250608213336498](assets/image-20250608213336498.png)

AIä¿®å¤è¿™é‡Œçš„é—®é¢˜ä¼šæŠ¥é”™,æ‰‹åŠ¨ä¿®å¤

![image-20250608215838795](assets/image-20250608215838795.png)

backend/core/database.py,è¿™é‡Œå°±éœ€è¦è¯¦ç»†çš„äº†è§£`tortoise` çš„ä½¿ç”¨æ–¹å¼äº†,å¯ä»¥æŸ¥çœ‹`tortoise`çš„å®˜ç½‘å­¦ä¹ ä¸€ä¸‹

https://tortoise.github.io/

ä¿®å¤å¦‚ä¸‹:

```
# Tortoise ORM é…ç½®
TORTOISE_ORM = {
    "connections": {
        "default": DATABASE_URL
    },
    "apps": {
        "models": {
            "models": [
                "backend.models",
                "aerich.models"
            ],
            "default_connection": "default",
        },
    },
}
```

å†æ¬¡å¯åŠ¨æŠ¥é”™,` åˆ›å»ºé»˜è®¤ç”¨æˆ·å¤±è´¥: default_connection for the model <class 'backend.models.user.User'> cannot be None`

![image-20250608220209115](assets/image-20250608220209115.png)

è¿™ä¸€å—çš„ä¿®æ”¹éœ€è¦äº†è§£Pythonç›¸å…³åº“çš„ä½¿ç”¨,å’ŒAIè¿›è¡Œå¯¹è¯

```
backend/core/init_app.py å’Œ  backend/core/database.pyä»£ç æœ‰é‡åˆçš„éƒ¨åˆ†,ä»£ç åˆå¹¶åˆ°database.pyä¸­,ä¸”ä¸€äº›ç›®å½•å˜é‡ä½¿ç”¨backend/conf/constants.pyå®šä¹‰å¥½çš„å˜é‡,æ¯”å¦‚from backend.conf.constants import backend_path
DATABASE_URL = os.path.join(backend_path, "data", "aitestlab.db")
å°†å—åˆ°å½±å“çš„ä»£ç è¿›è¡Œä¿®æ”¹
```

![image-20250608234541536](assets/image-20250608234541536.png)

![image-20250608234501162](assets/image-20250608234501162.png)



AIåŠ©æ‰‹ç”Ÿæˆçš„ä»£ç æŠ¥é”™

![image-20250608234446045](assets/image-20250608234446045.png)



é˜…è¯»AIçš„ä»£ç ,å‘ç°é—®é¢˜,ä¿®å¤å¦‚ä¸‹

![image-20250608235148731](assets/image-20250608235148731.png)



æ­¤æ—¶å†æ¬¡å¯åŠ¨åº”ç”¨,å·²ç»OK

![image-20250608235223147](assets/image-20250608235223147.png)



ç™»é™†ç•Œé¢:

![image-20250608235423675](assets/image-20250608235423675.png)



é¡ºåˆ©ç™»é™†

![image-20250608235456574](assets/image-20250608235456574.png)

æ¥ä¸‹æ¥æˆ‘ä»¬ä¼˜åŒ–AIç”¨ä¾‹ç”Ÿæˆæ¨¡å—

### ä¼˜åŒ–

![image-20250608235747785](assets/image-20250608235747785.png)



æˆ‘ä¹‹å‰åšçš„æµ‹è¯•æ™ºèƒ½ä½“è¿˜æ˜¯æ¯”è¾ƒå¥½çœ‹çš„,å› æ­¤æˆ‘ç›´æ¥å°†ç›¸å…³çš„æ¨¡ç‰ˆç»™åˆ°AIåŠ©æ‰‹

![image-20250609000018969](assets/image-20250609000018969.png)



```
AIç”¨ä¾‹æ™ºèƒ½ä½“çš„å‰ç«¯è¯·ä»¿ç…§å›¾ä¸­å¹³å°çš„è¿›è¡Œä¼˜åŒ–
é¡µé¢çš„å·¦è¾¹ä¸ºæ­¥éª¤åŠå®æ—¶å±•ç¤ºçš„ç»“æœ,å³ä¾§å±•ç¤ºç”¨ä¾‹æ ¹æ®å†…å®¹ç”Ÿæˆçš„ç”¨ä¾‹
```



![image-20250609001059913](assets/image-20250609001059913.png)



![image-20250609001416441](assets/image-20250609001416441.png)

å‰ç«¯æ•ˆæœ:

![image-20250609001611595](assets/image-20250609001611595.png)



æ•ˆæœè¿˜æ˜¯ä¸é”™çš„,æœ‰äº›é¢œè‰²æ¯”è¾ƒç‰¹å¼‚çš„åœ°æ–¹æˆ‘ä»¬æœ€åä¼˜åŒ–,æ¥ä¸‹æ¥æˆ‘ä»¬ä¼˜åŒ–ä¸€ä¸‹åç«¯çš„ä»£ç 

### é—®é¢˜

ç°åœ¨æµ‹è¯•ç”¨ä¾‹æ¨¡å—æ²¡æœ‰çœŸæ­£çš„å’Œåç«¯è¿›è¡Œè”è°ƒ

![image-20250609002619329](assets/image-20250609002619329.png)

ç»§ç»­å’ŒAIè¿›è¡Œå¯¹è¯

```
å½“å‰æµ‹è¯•ç”¨ä¾‹æ¨¡å—å‰ç«¯æ²¡æœ‰å’Œåç«¯è¿›è¡Œäº¤äº’,è¯·é˜…è¯»åç«¯çš„ç›¸åº”ä»£ç ,æ‰“é€šå‰åç«¯
```

![image-20250609003204385](assets/image-20250609003204385.png)

![image-20250609003637476](assets/image-20250609003637476.png)

å¯åŠ¨åæŸ¥çœ‹

![image-20250609003953565](assets/image-20250609003953565.png)

æŸ¥çœ‹åç«¯ä»£ç :

æµå¼è¾“å‡ºè¿™æ®µä»£ç ä¸­,æˆ‘çš„é¢„æœŸæ˜¯,ç­‰å¾…ç”¨æˆ·è¾“å‡ºä½¿ç”¨`UserProxyAgent` å‡½æ•°,ç”¨æˆ·åŒæ„å’Œæœ€å¤§æ¬¡æ•°3æ¬¡ä¸º`RoundRobinGroupChat`ä¸­çš„ExternalTermination TextMentionTermination

![image-20250609004056222](assets/image-20250609004056222.png)

![image-20250609004310644](assets/image-20250609004310644.png)

ä¿®å¤è¿™éƒ¨åˆ†çš„ä»£ç ,æˆ‘å…ˆä½¿ç”¨ä¸€æ®µå·²æœ‰çš„ä»£ç ,è®©AIæ¥ä»¿å†™,å¦‚æœä¸è¡Œ,æˆ‘å†æ‰‹å†™

### é—®é¢˜ä¿®å¤

å†æ¬¡å’ŒAIè¿›è¡Œå¯¹è¯

```
å‚è€ƒexamples/testcase_agents.pyä¸­çš„é€»è¾‘,å®ŒæˆAIæµ‹è¯•ç”¨ä¾‹ç”Ÿæˆçš„åç«¯ä»£ç ,å’Œç”¨æˆ·äº¤äº’çš„ä»£ç    team = RoundRobinGroupChat([testcase_generator_agent, user_proxy], termination_condition=termination_en | termination_zh, )
ç»ˆæ­¢æ¡ä»¶ä¸ºè¯¢é—®ç”¨æˆ·ä¸‰æ¬¡æˆ–è€…ç”¨æˆ·å›å¤åŒæ„,ç»ˆæ­¢æ¡ä»¶çš„ä»£ç å‚è€ƒ:https://microsoft.github.io/autogen/stable//user-guide/agentchat-user-guide/tutorial/termination.html
å‰ç«¯ç”¨ä¾‹è§£ææ–‡ä»¶çš„ä»£ç å‚è€ƒexamples/requirement_agents.pyä¸­çš„RequirementAcquisitionAgent

åç«¯é€»è¾‘:
è§£ææ–‡ä»¶(å¦‚æœå­˜åœ¨)å’Œç”¨æˆ·æè¿°çš„éœ€æ±‚é‡ç‚¹ -> ç”Ÿæˆç”¨ä¾‹ -> å’Œç”¨æˆ·äº¤äº’ -> æ™ºèƒ½ä½“è¯„å®¡ä¼˜åŒ–è¾“å‡ºæœ€ç»ˆç‰ˆ
è¿™ä¸ªè¿‡ç¨‹,æ¯ä¸ªæ™ºèƒ½ä½“çš„è¾“å‡ºçš„å†…å®¹éƒ½è¿”å›åˆ°å‰ç«¯,ä¸”å‘ŠçŸ¥å“ªä¸ªæ™ºèƒ½ä½“çš„è¾“å‡º
å‰ç«¯åç«¯å¯ä»¥è°ƒé€š
ä»£ç åšå¥½æ³¨é‡ŠåŠlogæ‰“å°
```

ä¸Šè¿°ç”Ÿæˆä»£ç ä¸ç†æƒ³,è¿”å›è°ƒæ•´èŠå¤©å†æ¬¡å’ŒAIè¿›è¡Œå¯¹è¯

```
åç«¯åŸºäºFastapiæä¾›æ¥å£ï¼Œä½¿ç”¨sseåè®®è¿›è¡Œæµå¼è¾“å‡ºï¼Œä»£ç æ”¾åˆ°backendç›®å½•
ä½¿ç”¨autogen0.5.7 å®ç°ä¸å¤§æ¨¡å‹å¯¹è¯ï¼Œå…ˆé˜…è¯»æ•´ä½“ä»£ç çš„é€»è¾‘
ä¿®æ”¹backend/services/testcase_service.py  æ–‡ä»¶ä¸‹TestCaseServiceç±»ä¸­çš„generate_testcase_streamçš„é€»è¾‘,å‚ç…§examples/testcase_agents.pyä¸­ UserProxyAgentå’ŒRoundRobinGroupChatçš„ä½¿ç”¨ team = RoundRobinGroupChat([testcase_generator_agent, user_proxy], termination_condition=termination_en | termination_zh, )
ç»ˆæ­¢æ¡ä»¶ä¸ºè¯¢é—®ç”¨æˆ·ä¸‰æ¬¡æˆ–è€…ç”¨æˆ·å›å¤åŒæ„,ç»ˆæ­¢æ¡ä»¶çš„ä»£ç å‚è€ƒ:https://microsoft.github.io/autogen/stable//user-guide/agentchat-user-guide/tutorial/termination.html
è¿™ä¸ªè¿‡ç¨‹,æ¯ä¸ªæ™ºèƒ½ä½“çš„è¾“å‡ºçš„å†…å®¹éƒ½è¿”å›åˆ°å‰ç«¯,ä¸”å‘ŠçŸ¥å“ªä¸ªæ™ºèƒ½ä½“çš„è¾“å‡º
ä»£ç åšå¥½æ³¨é‡ŠåŠlogæ‰“å°
è§£æä¸Šä¼ æ–‡ä»¶çš„ä»£ç å‚è€ƒå¦‚ä¸‹
from llama_index.core import Document, SimpleDirectoryReader
    async def get_document_from_files(self, files: list[str]) -> str:
        """è·å–æ–‡ä»¶å†…å®¹"""
        try:
            data = SimpleDirectoryReader(input_files=files).load_data()
            doc = Document(text="\n\n".join([d.text for d in data[0:]]))
            return doc.text
        except Exception as e:
            raise Exception(f"æ–‡ä»¶è¯»å–å¤±è´¥: {str(e)}")

    async def get_document_from_llm_files(self, files: list[str]) -> str:
        """è·å–æ–‡ä»¶å†…å®¹ï¼Œæ”¯æŒå›¾ç‰‡ã€æµç¨‹å›¾ã€è¡¨æ ¼ç­‰æ•°æ®"""
        extract_contents = ""
        for file in files:
            contents = extract_text_from_llm(file)
            extract_contents += contents + "\n\n--------------\n\n"
        return extract_contents
```



![image-20250609114319953](assets/image-20250609114319953.png)

AIåŠ©æ‰‹æ•´ç†æ€è·¯å¦‚ä¸‹:

![image-20250609114532989](assets/image-20250609114532989.png)



ä»£ç å®Œæˆåè°ƒè¯•

![image-20250609115909226](assets/image-20250609115909226.png)

å‰ç«¯å¹¶ä¸ºè¾“å‡º,ä½†æ˜¯åç«¯å…¶å®æ˜¯æŠŠå†…å®¹è¾“å‡ºåˆ°å‰ç«¯äº†,éœ€è¦ä¿®æ”¹å‰ç«¯

### è§£å†³å‰ç«¯ä¸å®æ—¶è¾“å‡ºçš„é—®é¢˜

å†æ¬¡å’ŒAIè¿›è¡Œå¯¹è¯

```
ä¿®å¤é—®é¢˜:
åç«¯çš„æ—¥å¿—æ›´åŠ çš„ç»†ç²’åº¦,éœ€è¦æ‰“å°æ¯ä¸ªæ™ºèƒ½ä½“è¾“å‡ºçš„è¯¦ç»†æ—¥å¿—
æµ‹è¯•ç”¨ä¾‹ç”Ÿæˆçš„æ¨¡å—çš„å‰ç«¯ä¸èƒ½å®æ—¶è¾“å‡ºæ™ºèƒ½ä½“çš„æ¶ˆæ¯(éœ€è¦å‘ŠçŸ¥æ˜¯å“ªä¸ªæ™ºèƒ½ä½“çš„å›å¤)
```

![image-20250609125030739](assets/image-20250609125030739.png)



è¿™æ¬¡ä¼˜åŒ–å,å‰ç«¯é—®é¢˜æ²¡æœ‰ä¿®å¤,åç«¯æ—¥å¿—æ›´åŠ è¯¦ç»†äº†

![image-20250609125945899](assets/image-20250609125945899.png)

éœ€è¦å†æ¬¡å’ŒAIæ˜ç¡®å†…å®¹:

```
æµ‹è¯•ç”¨ä¾‹ç”Ÿæˆæ¨¡å—çš„å‰ç«¯å¹¶ä¸èƒ½æ­£ç¡®å®æ—¶è¾“å‡ºæ™ºèƒ½ä½“çš„å†…å®¹,è¯·ä¿®æ”¹å‰ç«¯ä»£ç ,è®©æ™ºèƒ½ä½“çš„å†…å®¹å±•ç¤ºåˆ°é¡µé¢çš„AIåˆ†æç»“æœä¸­

```



ä¼˜åŒ–å,å‰ç«¯è¿˜æ˜¯æŠ¥é”™

![image-20250609130846531](assets/image-20250609130846531.png)



å‰ç«¯çš„é”™è¯¯é—®é¢˜,æˆ‘ä»¬ä¸€èˆ¬è®©AIæ¥å¸®å¿™ä¿®å¤

```
ä¿®å¤frontend/src/pages/TestCasePage.tsxçš„é”™è¯¯
testcase.ts:157 è§£æSSEæ•°æ®å¤±è´¥: SyntaxError: Unexpected token 'd', "data: {"so"... is not valid JSON
    at JSON.parse (<anonymous>)
    at generateTestCaseStream (testcase.ts:134:31)
    at async Object.generateTestCase [as onClick] (TestCasePage.tsx:277:7) åŸå§‹æ•°æ®: data: data: {"source": "testcase_generator", "content": "AT", "agent_type": "testcase_agent", "agent_name": "testcase_generator", "conversation_id": "81d79d3e-42df-4339-9ff8-565f8ecf4e2b", "round_number": 1, "is_complete": false, "is_final": false, "timestamp": "2025-06-09T13:08:16.198405"}
```

![image-20250609135525248](assets/image-20250609135525248.png)ä¼˜åŒ–åçš„ç»“æœ:

![image-20250609135441287](assets/image-20250609135441287.png)

é—®é¢˜:

ç”¨æˆ·åé¦ˆçš„åœ°æ–¹ä¼šå­˜åœ¨é—®é¢˜

![image-20250609135625073](assets/image-20250609135625073.png)



å¦å¤–,æ™ºèƒ½ä½“è¿”å›çš„å†…å®¹æœ€å¥½ä¹Ÿä½¿ç”¨markdownæ¥è¿›è¡Œä¸€ä¸‹ç¾åŒ–

ç»§ç»­å’ŒAIè¿›è¡Œå¯¹è¯

```
å‰ç«¯ç”¨æˆ·åé¦ˆæ„è§çš„éƒ¨åˆ†,api/testcase/feedback æ¥å£è°ƒç”¨æŠ¥é”™å¦‚ä¸‹,è¯·ä¿®å¤
ä¼ å…¥å†…å®¹:
{
  "conversation_id": "96eedbe8-2275-4883-a73a-789dae0eca79",
  "feedback": "å¢åŠ æ€§èƒ½æµ‹è¯•",
  "round_number": 1
}
ç»“æœæŠ¥é”™:
[
  {
    "type": "missing",
    "loc": [
      "query",
      "conversation_id"
    ],
    "msg": "Field required",
    "input": null
  },
  {
    "type": "missing",
    "loc": [
      "query",
      "feedback"
    ],
    "msg": "Field required",
    "input": null
  },
  {
    "type": "missing",
    "loc": [
      "query",
      "round_number"
    ],
    "msg": "Field required",
    "input": null
  }
]
```



### ä¼˜åŒ–æ™ºèƒ½ä½“

çœ‹äº†æ•´ä½“çš„æ™ºèƒ½ä½“é€»è¾‘æ²¡æœ‰æŒ‰ç…§æˆ‘å½“æ—¶è§„å®šçš„`SingleThreadedAgentRuntime` è¿è¡Œæ—¶æ¥å®Œæˆç›¸å…³ä»£ç , è€Œä¸”å¯¼å…¥çš„ä¸€äº›ä»£ç ä¹Ÿ`from examples.llms import openai_model_client`ä¹Ÿéƒ½ä¸æ­£ç¡®,ä¸€æ­¥æ­¥æ¥

```
å‚è€ƒexamples/topic.pyä¸­ SingleThreadedAgentRuntime çš„ä½¿ç”¨,æ”¹å†™backend/services/testcase_service.py æ¯ä¸ªæ™ºèƒ½ä½“ä½¿ç”¨RoutedAgent,æ”¶é›†æ¶ˆæ¯è¿”å›åˆ°å‰ç«¯ä½¿ç”¨ClosureAgentå®Œæˆ
https://microsoft.github.io/autogen/stable/user-guide/core-user-guide/framework/agent-and-agent-runtime.html ä¸­çš„ä¾‹å­ä¹Ÿå¯ä»¥æ‹¿æ¥å‚ç…§
```



![image-20250609143307157](assets/image-20250609143307157.png)



æ”¹å†™å®Œæˆ

![image-20250609143942960](assets/image-20250609143942960.png)



è¿è¡Œæ—¶æŠ¥é”™,è¿™ä¸ªé—®é¢˜è®©AIæ¥ä¿®å¤å³å¯

```
2025-06-09 14:40:32 | ERROR    | backend.services.testcase_service:generate_testcase_stream:273 | ç”Ÿæˆæµ‹è¯•ç”¨ä¾‹å¤±è´¥ | å¯¹è¯ID: f6258cfb-7d33-4b3f-82af-79cba76b0a1f | é”™è¯¯: Closure must have 4 arguments

```

ç»§ç»­å’ŒAIè¿›è¡Œå¯¹è¯

```
2025-06-09 14:40:32 | ERROR    | backend.services.testcase_service:generate_testcase_stream:273 | ç”Ÿæˆæµ‹è¯•ç”¨ä¾‹å¤±è´¥ | å¯¹è¯ID: f6258cfb-7d33-4b3f-82af-79cba76b0a1f | é”™è¯¯: Closure must have 4 arguments
ä»£ç æŠ¥é”™,è¯·ä¿®å¤
```



![image-20250609144914121](assets/image-20250609144914121.png)





ä½†æ˜¯è¿è¡ŒæŠ¥ç›¸åŒçš„é”™è¯¯,å¯¹äºè¿™ç§åç«¯é—®é¢˜,éœ€è¦è‡ªå·±æ¥ä¿®æ”¹ä»£ç äº†,å…·ä½“é”™è¯¯åº”è¯¥æ˜¯å¦‚ä¸‹

![image-20250609145519113](assets/image-20250609145519113.png)

ClosureAgentçš„ä»£ç ä½¿ç”¨å¯ä»¥å‚è€ƒå¦‚ä¸‹:

https://microsoft.github.io/autogen/stable/user-guide/core-user-guide/cookbook/extracting-results-with-an-agent.html

`backend/services/testcase_service.py`æœ‰é—®é¢˜çš„ä»£ç 

```
    async def _collect_result(
        self, runtime, id, payload: AgentResultMessage, ctx: MessageContext
    ) -> None:
```



### é—®é¢˜ä¿®å¤

æ—¥å¿—ä¸€ç›´æœ‰ä¹±ç çš„æƒ…å†µ

![image-20250609175603134](assets/image-20250609175603134.png)

ç»§ç»­å’ŒAIè¿›è¡Œå¯¹è¯

```
[32m2025-06-09 17:53:02[0m | [31m[1mERROR   [0m | [36mbackend.api.testcase[0m:[36mgenerate[0m:[36m155[0m | [31m[1m[APIé”™è¯¯] å¯¹è¯ID: 559af4e4-b1bb-44d4-8b7f-adbce341b236 | é”™è¯¯æ•°æ®: {'source': 'system', 'content': 'ç”Ÿæˆè¿‡ç¨‹ä¸­å‡ºé”™: Closure must have 4 arguments', 'agent_type': 'user_proxy', 'agent_name': 'system', 'conversation_id': '559af4e4-b1bb-44d4-8b7f-adbce341b236', 'round_number': 1, 'is_complete': True, 'is_final': True, 'timestamp': '2025-06-09T17:53:02.477444'}[0m
åç«¯çš„æ—¥å¿—ä¸­ä¸€ç›´æœ‰è¿™ç§ä¹±ç çš„æ—¥å¿—æƒ…å†µ,è¯·ä¿®å¤
```

![image-20250609181840997](assets/image-20250609181840997.png)





###  ä¿®å¤ Closure must have 4 argumentsçš„é—®é¢˜

è¾“å‡ºçš„æ—¥å¿—å¦‚ä¸‹

![image-20250609181957776](assets/image-20250609181957776.png)

ä¸Šè¿°æ—¥å¿—å¯ä»¥æŸ¥çœ‹åˆ°,åœ¨æ³¨å†Œæ™ºèƒ½ä½“çš„ä»£ç å—å†…æ²¡æœ‰æ³¨å†Œå®Œæˆ

ç»“åˆ`Closure must have 4 arguments`çš„å¼‚å¸¸

å®šä½åˆ°,è¿™ä¸ªAIç”Ÿæˆäº†éœ€è¦ä¼ å…¥request,è€Œrequestçš„å†…å®¹ä¸º`{'source': 'system', 'content': 'ç”Ÿæˆè¿‡ç¨‹ä¸­å‡ºé”™: Closure must have 4 arguments', 'agent_type': 'user_proxy', 'agent_name': 'system', 'conversation_id': '51ee344a-7a9c-4bfa-8e69-5e314a8d248c', 'round_number': 1, 'is_complete': True, 'is_final': True, 'timestamp': '2025-06-09T18:07:38.704597'}`

![image-20250609182248079](assets/image-20250609182248079.png)

ä½†requestçš„ç»“æ„ä¸º

![image-20250609182351468](assets/image-20250609182351468.png)

è¯¥å¤„çš„ä»£ç å»æ‰requestå³å¯

æ›´æ–°åæµ‹è¯•ä»£ç ä¾ç„¶æŠ¥é”™,æŠ¥é”™åŸå› ç›¸åŒ

ç»§ç»­å’ŒAIè¿›è¡Œå¯¹è¯

```
backend/services/testcase_service.pyä¸­å°†ClosureAgentç”¨RoutedAgentæ¥è¿›è¡Œæ›¿ä»£,ä¿®æ”¹ä»£ç 
```

![image-20250609195146452](assets/image-20250609195146452.png)



ä¿®å¤å

![image-20250609200341802](assets/image-20250609200341802.png)

å½“å‰çš„é—®é¢˜,æ‰€æœ‰çš„æ¶ˆæ¯éƒ½æ˜¯ä¸€æ¬¡æ€§çš„è¿”å›çš„,è€Œä¸”éœ€æ±‚åˆ†æå¸ˆçš„è¿”å›å†…å®¹è¿˜æ²¡æœ‰æ­£ç¡®è§£æ

ç»§ç»­å’ŒAIè¿›è¡Œå¯¹è¯

```
é—®é¢˜ä¿®å¤:
	å‰ç«¯: frontend/src/pages/TestCasePage.tsxçš„å‰ç«¯é¡µé¢å¸ƒå±€å­˜åœ¨é—®é¢˜,AIåˆ†æç»“æœè¡¨ä¸­,å±•ç¤ºçš„æµå¼è¾“å‡ºä¸å®Œæ•´
	æ”¶åˆ°çš„éœ€æ±‚åˆ†æå¸ˆçš„æ•°æ®è§£æä¸æ­£å¸¸
	å‰åç«¯é—®é¢˜:å½“å‰è¾“å‡ºä¸æ˜¯sseçš„æ–¹å¼è¾“å‡º,æ‰€æœ‰çš„å†…å®¹ä¸€èµ·è¾“å‡º
```



![image-20250609201045605](assets/image-20250609201045605.png)



```
examples/agent/testcase.py ä¸ºfastapiçš„æ¥å£,examples/agent/testcase_agents.pyä¸ºå¤šæ™ºèƒ½ä½“æ¨¡å—,è¿™æ˜¯websocketçš„å®ç°,è¯·ä»¿ç…§ç€è¿™ä¸¤ä¸ªä»£ç æ–‡ä»¶,å®ç°æœ¬é¡¹ç›®çš„é€»è¾‘,æ³¨æ„,æœ¬é¡¹ç›®ä½¿ç”¨SSEè€Œéwebsocket,å¯ä»¥å€Ÿé‰´ä¸¤ä¸ªä»£ç ä¸­ClosureAgent(ç”¨æ¥å°†æ¶ˆæ¯è¿”å›åˆ°å‰ç«¯)å’ŒUserProxyAgent(ç”¨æ¥å’Œç”¨æˆ·äº¤äº’è·å–ç”¨æˆ·çš„éœ€æ±‚)çš„ç”¨æ³•,æ”¹å†™æœ¬é¡¹ç›®backend/api/testcase.pyå’Œbackend/services/testcase_service.py
```





ä»£ç ä¿®å¤å,å†æ¬¡é‡åˆ°æŠ¥é”™

```
backend/services/testcase_service.py æœ‰å¤§é‡çš„æŠ¥é”™,è¯·ä¿®å¤,æ¯”å¦‚File "/Users/bytedance/PycharmProjects/my_best/AITestLab/backend/core/init_app.py", line 14, in <module>
    from backend.api.testcase import router as testcase_router
  File "/Users/bytedance/PycharmProjects/my_best/AITestLab/backend/api/testcase.py", line 27, in <module>
    from backend.services.testcase_service import (
  File "/Users/bytedance/PycharmProjects/my_best/AITestLab/backend/services/testcase_service.py", line 660, in <module>
    @type_subscription(topic_type=USER_FEEDBACK_TOPIC)
                                  ^^^^^^^^^^^^^^^^^^^
NameError: name 'USER_FEEDBACK_TOPIC' is not defined
```



æ”¹æ¥æ”¹å»,éƒ½æœ‰é—®é¢˜,æœ‰ç‚¹æ°”äººå•Š,æˆ‘æ‰“ç®—è‡ªå·±æ‰‹å†™è¿™å—çš„ä»£ç äº†,ä¸ç®¡äº†,æ‰‹æ’¸è¿™å—ä»£ç 











### æ‚é¡¹ä¼˜åŒ–

ç»§ç»­å’ŒAIè¿›è¡Œå¯¹è¯

```
åˆ é™¤å‰ç«¯çš„æ— ç”¨é¡µé¢:æ»šåŠ¨æµ‹è¯•å’Œå¸®åŠ©
å¢åŠ æ•°æ®åº“çš„è¿ç§»å’Œä½¿ç”¨,ä½¿ç”¨Aerich
å¯¹docsè¿›è¡Œæ•´ç†,docsæ–‡æ¡£æ ¹ç›®å½•ä¸‹ç•™ä¸‹ä¸€ä¸ªreadmeæ–‡æ¡£,å…¶ä½™åˆ†é—¨åˆ«ç±»çš„æ”¾åˆ°åˆé€‚çš„æ–‡ä»¶å¤¹å†…
æ ¹æ®å½“å‰å¼€å‘çš„å†…å®¹,é‡æ–°å¯¹æ ¹ç›®å½•ä¸‹README.mdè¿›è¡Œä¼˜åŒ–
æ ¹ç›®å½•ä¸‹çš„æµ‹è¯•æ–‡ä»¶æ”¾åˆ°testç›®å½•ä¸‹
```

![image-20250609020822304](assets/image-20250609020822304.png)



### ä¼˜åŒ–

å†æ¬¡ä¼˜åŒ–,å’ŒAIå¯¹è¯

```
å‰ç«¯ç™»å½•ç•Œé¢å»æ‰è´¦æˆ·åå’Œå¯†ç çš„æç¤º
å»æ‰ä¾§è¾¹æ çš„å¸®åŠ©å’Œæ»šåŠ¨æµ‹è¯•
ä¿®å¤ä¾§è¾¹æ çš„æŠ˜å æŒ‰é’®,å³è¾¹æœªå±•ç¤ºçš„é—®é¢˜
æ ¹æ®å½“å‰å¼€å‘çš„å†…å®¹,é‡æ–°å¯¹æ ¹ç›®å½•ä¸‹README.mdè¿›è¡Œä¼˜åŒ–,ä¼˜åŒ–å†…å®¹æ”¾åˆ°README.mdä¸‹çš„å·¥ç¨‹æ­å»ºè®°å½•ç« èŠ‚å,ä¸Šé¢çš„å†…å®¹ä¸è¦åˆ é™¤,æ•´åˆå½“å‰å¼€å‘çš„å†…å®¹
```





### ä¼˜åŒ–

æ ¹æ®æ”¹åŠ¨é‡æ–°ç”Ÿæˆreadmeæ–‡æ¡£



```
å¢åŠ æ•°æ®åº“çš„è¿ç§»å’Œä½¿ç”¨,ä½¿ç”¨Aerich
å¯¹docsè¿›è¡Œæ•´ç†,docsæ–‡æ¡£æ ¹ç›®å½•ä¸‹ç•™ä¸‹ä¸€ä¸ªreadmeæ–‡æ¡£,å…¶ä½™åˆ†é—¨åˆ«ç±»çš„æ”¾åˆ°åˆé€‚çš„æ–‡ä»¶å¤¹å†…
æ ¹æ®å½“å‰å¼€å‘çš„å†…å®¹,é‡æ–°å¯¹æ ¹ç›®å½•ä¸‹README.mdè¿›è¡Œä¼˜åŒ–
æ ¹ç›®å½•ä¸‹çš„æµ‹è¯•æ–‡ä»¶æ”¾åˆ°testç›®å½•ä¸‹

```

å†…éƒ¨é€»è¾‘ä¼˜åŒ–

```
ç»ˆæ­¢æ¡ä»¶çš„éƒ¨åˆ†å‚è€ƒä¸‹é¢ä¹Ÿ: https://microsoft.github.io/autogen/stable//user-guide/agentchat-user-guide/tutorial/termination.html
```



å¯¹æ–‡æ¡£è¿›è¡Œæ•´ç†,docsæ–‡æ¡£ç•™ä¸‹ä¸€ä¸ªreadmeæ–‡æ¡£,å…¶ä½™åˆ†é—¨åˆ«ç±»çš„æ”¾åˆ°å„ä¸ªæ–‡ä»¶å¤¹å†…

readmeæ–‡æ¡£ä¹Ÿæ˜¯å¢åŠ ç›¸åº”çš„åŠŸèƒ½



æµ‹è¯•æ–‡ä»¶å¤¹æ”¾åˆ°ä¸€ä¸ªæµ‹è¯•ç›®å½•ä¸‹





### æ‰‹æ’¸åç«¯ä»£ç 

é€»è¾‘:

```
è¿è¡Œæ—¶å†…:
	éœ€æ±‚è§£ææ™ºèƒ½ä½“
	ç”¨ä¾‹ç”Ÿæˆæ™ºèƒ½ä½“
	ç”¨ä¾‹è¯„å®¡æ™ºèƒ½ä½“
	ç”¨æˆ·åé¦ˆ(åµŒå…¥åœ¨è¯„å®¡ä¸­)
	ç»“æ„åŒ–æ™ºèƒ½ä½“
	å…¥åº“æ™ºèƒ½ä½“

ç”¨æˆ·å‘é€æ¶ˆæ¯ -> SSEæ¥å£ -> è¿è¡Œæ—¶ -> è¿”å›ç»™å‰ç«¯ (äº¤äº’) -> æœ€ç»ˆè½åº“å,ç»“æ„åŒ–å‘ˆçŒ®åˆ°å‰ç«¯




```

åœ¨è¿™é‡Œå‘èµ·äº†åˆ†æè¯·æ±‚

![image-20250609212936428](assets/image-20250609212936428.png)

çœ‹å¾—æˆ‘çœŸæ˜¯å¤´ç–¼,æˆ‘å…ˆå†™åç«¯å§,åˆ°æ—¶å€™åœ¨è®©AIç”Ÿæˆå‰ç«¯

åé¢å†è®©AIå°è£…ä¸€ä¸ªapiæŠŠ,æ¥å£ç»Ÿä¸€ä¸€ä¸‹å§,å¦åˆ™å¤ªéš¾æ‰¾æ¥å£äº†

```
å‰ç«¯å°è£…ä¸€ä¸ªè¯·æ±‚æ¨¡å—,è¦æ±‚æ”¯æŒåç«¯SSEæ¥å£æ¥å…¥,å‰åç«¯ç»Ÿä¸€è§„èŒƒ,æ–¹ä¾¿æ¥å…¥
```









#### å‰ç«¯çš„ä»£ç è°ƒç”¨å“ªäº›æ¥å£

åˆ†æ`frontend/src/pages/TestCasePage.tsx`

å¥½ä¹…æ²¡çœ‹react,çœ‹å¾—æˆ‘æœ‰ç‚¹å¤´ç–¼



```å¯¹åç«¯æ¥å£
æŸ¥çœ‹å‰ç«¯frontend/src/pages/TestCasePage.tsxä»£ç å¯¹åç«¯ç”¨ä¾‹æ¥å£è¿›è¡Œæ¢³ç†,åˆ é™¤åç«¯backend/api/testcase.pyä¸­æ²¡æœ‰ç”¨çš„æ¥å£
```



#### sseç¼–å†™ä»£ç çš„æ ¸å¿ƒé€»è¾‘

##### åŸºç¡€

è¯·æ±‚å¤´å®ç°

```
response.headers["Content-Type"] = "text/event-stream"
response.headers["Cache-Control"] = "no-cache"
response.headers["Connection"] = "keep-alive"
```

æ•°æ®æ ¼å¼

```
yield f"data: {json.dumps(data)}\n\n"

```

SSEè¦æ±‚æ¯æ¡æ¶ˆæ¯ä»¥"data: "å¼€å¤´ï¼Œä»¥ä¸¤ä¸ªæ¢è¡Œç¬¦"\n\n"ç»“æŸã€‚

ä½¿ç”¨`async def`å’Œ`yield`åˆ›å»ºå¼‚æ­¥ç”Ÿæˆå™¨ï¼Œé¿å…é˜»å¡ã€‚

å¼‚æ­¥å˜æˆçš„ä½¿ç”¨:

```
def generate_stock_data():
    stocks = ["AAPL", "GOOGL", "MSFT", "AMZN", "TSLA"]
    while True:
        stock = random.choice(stocks)
        price = round(random.uniform(100, 500), 2)
        change = round(random.uniform(-10, 10), 2)
        change_percent = round((change / price) * 100, 2)
        yield {
            "symbol": stock,
            "price": price,
            "change": change,
            "change_percent": change_percent,
            "timestamp": time.time()
        }
        time.sleep(1)  # æ¯ç§’æ›´æ–°ä¸€æ¬¡

è°ƒç”¨:
async def main():
    # async for data in generate_stock_data():
    #     print(data)
    data = generate_stock_data()
    async for i in data:
        print(i)
```





ä¸€ä¸ªdemo

fastapiçš„æ¥å£å†…ä¸€ä¸ªå¼‚æ­¥è¿­ä»£å™¨

```
@router.post("/stream")
async def chat_stream(request: ChatRequest):
    """æµå¼èŠå¤©æ¥å£"""
    conversation_id = request.conversation_id or str(uuid.uuid4())
    logger.info(
        f"æ”¶åˆ°æµå¼èŠå¤©è¯·æ±‚ | å¯¹è¯ID: {conversation_id} | æ¶ˆæ¯: {request.message[:50]}..."
    )

    try:

        async def generate():
            try:
                logger.debug(f"å¼€å§‹ç”Ÿæˆæµå¼å“åº” | å¯¹è¯ID: {conversation_id}")
                chunk_count = 0

                async for chunk in autogen_service.chat_stream(
                    message=request.message,
                    conversation_id=conversation_id,
                    system_message=request.system_message or "ä½ æ˜¯ä¸€ä¸ªæœ‰ç”¨çš„AIåŠ©æ‰‹",
                ):
                    chunk_count += 1
                    logger.debug(
                        f"ç”Ÿæˆç¬¬ {chunk_count} ä¸ªæ•°æ®å— | å†…å®¹é•¿åº¦: {len(chunk)}"
                    )

                    # å‘é€å†…å®¹å—
                    chunk_data = StreamChunk(
                        content=chunk,
                        is_complete=False,
                        conversation_id=conversation_id,
                    )
                    yield f"data: {chunk_data.model_dump_json()}\n\n"

                # å‘é€å®Œæˆä¿¡å·
                final_chunk = StreamChunk(
                    content="", is_complete=True, conversation_id=conversation_id
                )
                yield f"data: {final_chunk.model_dump_json()}\n\n"
                logger.success(
                    f"æµå¼å“åº”å®Œæˆ | å¯¹è¯ID: {conversation_id} | æ€»å—æ•°: {chunk_count}"
                )

            except Exception as e:
                logger.error(
                    f"æµå¼å“åº”ç”Ÿæˆå¤±è´¥ | å¯¹è¯ID: {conversation_id} | é”™è¯¯: {e}"
                )
                error_chunk = StreamChunk(
                    content=f"é”™è¯¯: {str(e)}",
                    is_complete=True,
                    conversation_id=conversation_id,
                )
                yield f"data: {error_chunk.model_dump_json()}\n\n"

        return StreamingResponse(
            generate(),
            media_type="text/plain",
            headers={
                "Cache-Control": "no-cache",
                "Connection": "keep-alive",
                "Content-Type": "text/event-stream",
            },
        )

    except Exception as e:
        logger.error(f"æµå¼èŠå¤©æ¥å£å¼‚å¸¸ | å¯¹è¯ID: {conversation_id} | é”™è¯¯: {e}")
        raise HTTPException(status_code=500, detail=str(e))
```

Autogenå†…çš„å¼‚æ­¥è¿­ä»£å™¨

```
    async def chat_stream(
        self,
        message: str,
        conversation_id: Optional[str] = None,
        system_message: str = "ä½ æ˜¯ä¸€ä¸ªæœ‰ç”¨çš„AIåŠ©æ‰‹",
    ) -> AsyncGenerator[str, None]:
        """æµå¼èŠå¤©"""
        if not conversation_id:
            conversation_id = str(uuid.uuid4())

        logger.info(
            f"å¼€å§‹æµå¼èŠå¤© | å¯¹è¯ID: {conversation_id} | æ¶ˆæ¯: {message[:100]}..."
        )

        # æ‰§è¡Œè‡ªåŠ¨æ¸…ç†
        self._auto_cleanup()

        agent = self.create_agent(conversation_id, system_message)

        try:
            # è·å–æµå¼å“åº”
            logger.debug(f"è°ƒç”¨ Agent æµå¼å“åº” | å¯¹è¯ID: {conversation_id}")
            result = agent.run_stream(task=message)

            chunk_count = 0
            async for item in result:
                if isinstance(item, ModelClientStreamingChunkEvent):
                    if item.content:
                        chunk_count += 1
                        logger.debug(
                            f"æ”¶åˆ°æµå¼æ•°æ®å— {chunk_count} | å¯¹è¯ID: {conversation_id} | å†…å®¹: {item.content[:50]}..."
                        )
                        yield item.content

            logger.success(
                f"æµå¼èŠå¤©å®Œæˆ | å¯¹è¯ID: {conversation_id} | æ€»å—æ•°: {chunk_count}"
            )

        except Exception as e:
            logger.error(f"æµå¼èŠå¤©å¤±è´¥ | å¯¹è¯ID: {conversation_id} | é”™è¯¯: {e}")
            yield f"é”™è¯¯: {str(e)}
```



### æœ¬é¡¹ç›®ä»£ç æ ¸å¿ƒ

```
ClosureAgent è´Ÿè´£æŠŠæ¶ˆæ¯ä¼ é€ç»™å‰ç«¯

é‡æ–°è®¾è®¡ç”¨ä¾‹ç”Ÿæˆæ¨¡å—çš„åç«¯: backend/api/testcase.pyå’Œbackend/services/testcase_service.py
/generate/sse æ¥å£,å®ç°éœ€æ±‚åˆ†æ,åˆæ­¥ç”¨ä¾‹ç”Ÿæˆ   (éœ€æ±‚åˆ†ææ™ºèƒ½ä½“+ç”¨ä¾‹ç”Ÿæˆæ™ºèƒ½ä½“) å‘å¸ƒæ¶ˆæ¯: éœ€æ±‚åˆ†æ
/feedback  æ¥å£,ç”¨æˆ·æ ¹æ®åé¦ˆå†æ¬¡ç”Ÿæˆä¼˜åŒ–ç”¨ä¾‹ å½“è¾“å…¥æ„è§æ—¶  (ç”¨æˆ·åé¦ˆ + ç”¨ä¾‹è¯„å®¡ä¼˜åŒ–æ™ºèƒ½ä½“) å‘å¸ƒæ¶ˆæ¯: ç”¨ä¾‹ä¼˜åŒ–
å½“è¾“å…¥åŒæ„æ—¶ è¿”å›æœ€ç»ˆçš„ç»“æœ  -å®Œæˆæ•°æ®åº“è½åº“  (ç»“æ„åŒ– + å…¥åº“æ™ºèƒ½ä½“) å‘å¸ƒæ¶ˆæ¯:ç”¨ä¾‹ç»“æœ
ç›¸å½“äºç”¨è¿™ä¸¤ä¸ªæ¥å£æ¥è§¦å‘è¿è¡Œæ—¶çš„æ¶ˆæ¯å‘å¸ƒ
å°è£…ä¸€ä¸ªç±»

	å®ç°: æ ¹æ®å¯¹è¯çš„idè®°å½•å†å²æ¶ˆæ¯,å†å²æ¶ˆæ¯å®ç°å‚è€ƒ:https://microsoft.github.io/autogen/stable/user-guide/agentchat-user-guide/memory.html
	åˆå§‹åŒ–ä¸€ä¸ªè¿è¡Œæ—¶:æ³¨å†Œä¸Šè¿°æ™ºèƒ½ä½“
	å¯ä»¥æ ¹æ®æ¥å£,å‘å¸ƒè¿è¡Œæ—¶çš„æ¶ˆæ¯,è¿è¡Œæ—¶çš„ä»£ç å‚è€ƒ:https://microsoft.github.io/autogen/stable/user-guide/core-user-guide/framework/agent-and-agent-runtime.html
	å’Œç”¨æˆ·äº¤äº’ä½¿ç”¨UserProxyAgent,ä»£ç å‚è€ƒ:https://microsoft.github.io/autogen/stable/user-guide/agentchat-user-guide/tutorial/human-in-the-loop.html
	æå–æµ‹è¯•ç»“æœç»™åˆ°å‰ç«¯ä½¿ç”¨ClosureAgentä»£ç å‚è€ƒ: https://microsoft.github.io/autogen/stable/user-guide/core-user-guide/cookbook/extracting-results-with-an-agent.html
	å…¶ä»–ç›¸å…³ä»£ç è¿˜å¯ä»¥å€Ÿé‰´examples/agent/testcase.py  examples/agent/testcase_agents.pyçš„å®ç°




ä¹‹å‰ä½¿ç”¨websocket,ç›¸å½“äºåœ¨ä¸€ä¸ªé•¿è¿æ¥å†…,å®ç°ä¸Šè¿°ä¸‰ä¸ªæ¥å£çš„


```

æŠŠä¸Šè¿°é€»è¾‘è¿”å›ç»™AI,åœ¨AIçš„åŸºç¡€ä¸Šè¿›è¡Œä¼˜åŒ–å’Œå°è£…



```
backend/api/testcase.pyå’Œbackend/services/testcase_service.py æ—¥å¿—çš„è¾“å‡ºå°½é‡è¦å…¨,æ¯”å¦‚,æ‰“å°å‡ºä»€ä¹ˆæ™ºèƒ½ä½“åœ¨ä»€ä¹ˆé˜¶æ®µå‡ºäº†æ˜¯ä»€ä¹ˆäº‹ä»¶äº‹ä»¶çš„å†…å®¹,æ¯ä¸€ä¸ªæ­¥éª¤éƒ½è¯¦ç»†çš„æ‰“å°å‡ºæ¥,ä¸¤ä»½ä»£ç è¿›è¡Œç»™å‡ºè¯¦ç»†çš„æ³¨é‡Š
```



```
backend/api/testcase.py  backend/services/testcase_service.py
æ¥å£ä¿®æ”¹:è¾“å‡ºçš„å†…å®¹,ä¸ä»…ä»…è¦æœ€åçš„ç»“æœ,è¿˜éœ€è¦æµå¼è¾“å‡ºçš„æ‰€æœ‰å†…å®¹,ç„¶ååˆ°å‰ç«¯,ä¹‹åå‰ç«¯åšæµå¼è¾“å‡º
æ¥å£éƒ½ä¸ºä¿®æ”¹ä¸ºpostè¯·æ±‚
å‰ç«¯çš„é¡µé¢ä¸ºfrontend/src/pages/TestCasePage.tsx
from autogen_agentchat.messages import ModelClientStreamingChunkEvent, TextMessage
    async for event in stream:
        if isinstance(
            event, ModelClientStreamingChunkEvent
        ):  #  è¾“å‡ºæµï¼Œæ ¹æ®sourceå±æ€§åˆ¤æ–­æ˜¯å“ªä¸ªagentçš„è¾“å‡º
            print(event.content, end="", flush=True)
        if isinstance(event, TextMessage) and event.source == "primary":
            print(event.content)  # è¡¨ç¤ºprimaryæ™ºèƒ½ä½“æœ€ç»ˆçš„å®Œæ•´è¾“å‡º
            # break
        if isinstance(event, TextMessage) and event.source == "critic":
            print(event.content)  # è¡¨ç¤ºcriticæ™ºèƒ½ä½“æœ€ç»ˆçš„å®Œæ•´è¾“å‡º
            # break

        if isinstance(event, TaskResult):  # åŒ…å«æ‰€æœ‰æ™ºèƒ½ä½“çš„è¾“å‡ºï¼ŒåŒ…æ‹¬ç”¨æˆ·çš„è¾“å…¥
            print(
                event.messages
            )  # åˆ—è¡¨å­˜å‚¨ï¼Œæ¯ä¸ªå…ƒç´ æ˜¯ä¸€ä¸ªTextMessageï¼Œä»£è¡¨æ˜¯æ¯ä¸ªæ™ºèƒ½ä½“çš„è¾“å‡º
```





```
            logger.success(f"âœ… [æµ‹è¯•ç”¨ä¾‹ç”Ÿæˆæ™ºèƒ½ä½“] æµ‹è¯•ç”¨ä¾‹ç”Ÿæˆæ‰§è¡Œå®Œæˆ | å¯¹è¯ID: {conversation_id}")
            logger.info(f"   ğŸ“„ ç”Ÿæˆç»“æœé•¿åº¦: {len(testcases)} å­—ç¬¦")
            logger.debug(f"   ğŸ“ ç”Ÿæˆç»“æœé¢„è§ˆ: {testcases[:200]}...")æ—¥å¿—å°½é‡åˆå¹¶æˆä¸€æ¡,æ‰“å°å‡ºæµå¼æ—¥å¿—çš„å®Œæˆå†…å®¹,ä¸éœ€è¦è¿›è¡Œçœç•¥
```



```
frontend/src/pages/TestCasePage.tsx å‰ç«¯ä»£ç æœªå’Œåç«¯æ¥å£è¿›è¡Œé€‚é…,è¯·ä¿®æ”¹å‰ç«¯ä»£ç 
```





```
é—®é¢˜ä¿®å¤:
1. æ—¥å¿—ä¸­æ‰“å°çš„æ¶ˆæ¯ä¸æ­£ç¡®,å®Œæ•´æ¶ˆæ¯ä¸æ˜¯æ™ºèƒ½ä½“è¿”å›çš„æµå¼æ¶ˆæ¯
æ—¥å¿—æ ·ä¾‹å¦‚ä¸‹:2025-06-10 19:50:31 | INFO     | backend.api.testcase:generate:187 |    ğŸ“ å®Œæ•´æ¶ˆæ¯: éœ€æ±‚åˆ†ææ™ºèƒ½ä½“
2025-06-10 19:50:31 | INFO     | backend.services.testcase_service:_generate_streaming_output:696 | ğŸ“¤ [æµå¼è¾“å‡º] å¤„ç†æ¶ˆæ¯ 3 | æ™ºèƒ½ä½“: æµ‹è¯•ç”¨ä¾‹ç”Ÿæˆæ™ºèƒ½ä½“
2025-06-10 19:50:31 | INFO     | backend.api.testcase:generate:176 | ğŸ“¤ [æµå¼SSEç”Ÿæˆå™¨] å‘é€æµå¼æ•°æ® #42
2025-06-10 19:50:31 | INFO     | backend.api.testcase:generate:177 |    ğŸ·ï¸  ç±»å‹: streaming_chunk
2025-06-10 19:50:31 | INFO     | backend.api.testcase:generate:178 |    ğŸ¤– æ¥æº: æµ‹è¯•ç”¨ä¾‹ç”Ÿæˆæ™ºèƒ½ä½“
2025-06-10 19:50:31 | INFO     | backend.api.testcase:generate:176 | ğŸ“¤ [æµå¼SSEç”Ÿæˆå™¨] å‘é€æµå¼æ•°æ® #43
2025-06-10 19:50:31 | INFO     | backend.api.testcase:generate:177 |    ğŸ·ï¸  ç±»å‹: text_message
2025-06-10 19:50:31 | INFO     | backend.api.testcase:generate:178 |    ğŸ¤– æ¥æº: æµ‹è¯•ç”¨ä¾‹ç”Ÿæˆæ™ºèƒ½ä½“
2025-06-10 19:50:31 | INFO     | backend.api.testcase:generate:187 |    ğŸ“ å®Œæ•´æ¶ˆæ¯: æµ‹è¯•ç”¨ä¾‹ç”Ÿæˆæ™ºèƒ½ä½“
2. å‰ç«¯AIåˆ†æç»“æœè¡¨ä¸‹,æ²¡æœ‰å®æ—¶è¾“å‡ºæ™ºèƒ½ä½“è¿”å›çš„æ—¥å¿—
3.             result = await generator_agent.run(task=generation_task) è¿™ç§ä½¿ç”¨æ–¹å¼æ›¿æ¢ä¸ºæµå¼è¾“å‡ºrun_stream,å‰ç«¯å®æ—¶çš„å±•ç¤ºç»“æœ

```

æˆ‘æƒ³è¯´,ç°åœ¨çš„AIç†è§£èƒ½åŠ›çœŸçš„æ˜¯å¾ˆå¼º

![image-20250610200533222](assets/image-20250610200533222.png)



ä¿®å¤å:å‘ç°å‰ç«¯æŠ¥é”™

æ¥å£æ­£å¸¸è¾“å‡ºæ—¥å¿—:

![image-20250610203422991](assets/image-20250610203422991.png)

![image-20250610203343266](assets/image-20250610203343266.png)

```
å½“å‰åç«¯æ¥å£æ­£å¸¸,ä½†æ˜¯å‰ç«¯ä»£ç æŠ¥é”™,è¯·ä¿®å¤å‰ç«¯ä»£ç çš„æŠ¥é”™
testcase.ts:179 âŒ è§£æSSEæ•°æ®å¤±è´¥: SyntaxError: Unexpected end of JSON input
    at JSON.parse (<anonymous>)
    at startGeneration (testcase.ts:169:33)
    at async generate (testcase.ts:303:7)
    at async Object.generateTestCase [as onClick] (TestCasePage.tsx:331:7) data:
testcase.ts:179 âŒ è§£æSSEæ•°æ®å¤±è´¥: SyntaxError: Unexpected token 'd', "data: {"ty"... is not valid JSON
    at JSON.parse (<anonymous>)
    at startGeneration (testcase.ts:169:33)
    at async generate (testcase.ts:303:7)
    at async Object.generateTestCase [as onClick] (TestCasePage.tsx:331:7) data: data: {"type": "text_message", "source": "æµ‹è¯•ç”¨ä¾‹ç”Ÿæˆæ™ºèƒ½ä½“", "content": " ", "conversation_id": "c6a59ac4-159d-4a14-8f6e-618ddc265ea8", "message_type": "æµ‹è¯•ç”¨ä¾‹ç”Ÿæˆ", "is_complete": false, "timestamp": "2025-06-10T20:32:28.543163"}
2
testcase.ts:179 âŒ è§£æSSEæ•°æ®å¤±è´¥: SyntaxError: Unexpected end of JSON input
    at JSON.parse (<anonymous>)
    at startGeneration (testcase.ts:169:33)
    at async generate (testcase.ts:303:7)
    at async Object.generateTestCase [as onClick] (TestCasePage.tsx:331:7) data:
testcase.ts:179 âŒ è§£æSSEæ•°æ®å¤±è´¥: SyntaxError: Unexpected token 'd', "data: {"ty"... is not valid JSON
    at JSON.parse (<anonymous>)
    at startGeneration (testcase.ts:169:33)
    at async generate (testcase.ts:303:7)
    at async Object.generateTestCase [as onClick] (TestCasePage.tsx:331:7) data: data: {"type": "text_message", "source": "æµ‹è¯•ç”¨ä¾‹ç”Ÿæˆæ™ºèƒ½ä½“", "content": "æµ‹è¯•", "conversation_id": "c6a59ac4-159d-4a14-8f6e-618ddc265ea8", "message_type": "æµ‹è¯•ç”¨ä¾‹ç”Ÿæˆ", "is_complete": false, "timestamp": "2025-06-10T20:32:28.543733"}
```



![image-20250610213652553](assets/image-20250610213652553.png)

```
å‰ç«¯ç°åœ¨èƒ½å¤Ÿæ­£ç¡®çš„å¤„ç†sseçš„æ ¼å¼äº†,ä½†æ˜¯AIåˆ†æç»“æœè¡¨å¹¶æ²¡æœ‰å®æ—¶çš„è¾“å‡ºåç«¯çš„æµå¼æ—¥å¿—,è¯·ä¿®å¤è¿™ä¸ªé—®é¢˜
```



```
å½“å‰å‰ç«¯è¿˜ä¸èƒ½å®æ—¶è¾“å‡ºæµå¼æ—¥å¿—,æ¯”å¦‚æ¥å£è¿”å›çš„è¿™æ¡ä¿¡æ¯,å°±ä¸èƒ½å®æ—¶è¾“å‡º:data: {"type": "streaming_chunk", "source": "éœ€æ±‚åˆ†ææ™ºèƒ½ä½“", "content": "æµ‹è¯•", "conversation_id": "fff858e7-b82b-4608-8a7f-b88d8b215196", "message_type": "streaming", "timestamp": "2025-06-10T22:59:19.362047"}è¯·ä¿®å¤


```





```
é—®é¢˜ä¿®å¤
frontend/src/pages/TestCasePage.tsx,å½“å‰å‰ç«¯AIåˆ†æç»“æœè¡¨è¿˜ä¸èƒ½å®æ—¶è¾“å‡ºæµå¼æ—¥å¿—,æ¯”å¦‚æ¥å£è¿”å›çš„è¿™æ¡ä¿¡æ¯,å°±ä¸èƒ½å®æ—¶è¾“å‡º:
data: {"type": "text_message", "source": "éœ€æ±‚åˆ†ææ™ºèƒ½ä½“", "content": "ğŸ” æ”¶åˆ°ç”¨æˆ·éœ€æ±‚ï¼Œå¼€å§‹è¿›è¡Œä¸“ä¸šéœ€æ±‚åˆ†æ...", "conversation_id": "0b126fdc-cdd0-4fb0-9739-49801d69495d", "message_type": "éœ€æ±‚åˆ†æ", "is_complete": false, "timestamp": "2025-06-10T23:13:32.665223"}

data: {"type": "streaming_chunk", "source": "æµ‹è¯•ç”¨ä¾‹ç”Ÿæˆæ™ºèƒ½ä½“", "content": "é’ˆå¯¹", "conversation_id": "0b126fdc-cdd0-4fb0-9739-49801d69495d", "message_type": "streaming", "timestamp": "2025-06-10T23:14:14.506103"}

data: {"type": "streaming_chunk", "source": "éœ€æ±‚åˆ†ææ™ºèƒ½ä½“", "content": "è§„åˆ™", "conversation_id": "87f59475-e7e5-4f6a-935d-40d55b66bcdc", "message_type": "streaming", "timestamp": "2025-06-10T23:33:02.064722"}


{"content":"#","is_complete":false,"conversation_id":"4310028a-cbc1-4f57-9ff0-a3d99809bfc5"}
```





```
TestCasePage.tsxå‰ç«¯è¿˜æ˜¯æœ‰é—®é¢˜,frontend/src/pages/ChatPage.tsx ä¸­çš„æµå¼æ—¥å¿—å°±å¯ä»¥å®æ—¶æ˜¾ç¤º,æ˜¾ç¤ºçš„æ•°æ®å¦‚ä¸‹:{"content":"#","is_complete":false,"conversation_id":"4310028a-cbc1-4f57-9ff0-a3d99809bfc5"}
frontend/src/pages/TestCasePage.tsx ä¸­çš„æµå¼æ—¥å¿—ä¸èƒ½å®æ—¶æ˜¾ç¤ºdata: {"type": "streaming_chunk", "source": "éœ€æ±‚åˆ†ææ™ºèƒ½ä½“", "content": "è§„åˆ™", "conversation_id": "87f59475-e7e5-4f6a-935d-40d55b66bcdc", "message_type": "streaming", "timestamp": "2025-06-10T23:33:02.064722"}
è¯·å¯¹æ¯”ä¸€ä¸‹,æ‰¾å‡ºé—®é¢˜,ä¿®å¤TestCasePage.tsxä¸­çš„é—®é¢˜
```



```
æˆ‘ä¸æƒ³è¦ä½¿ç”¨frontend/src/apiä¸‹çš„ä»£ç ,è¯·é‡æ–°ä¿®æ”¹frontend/src/pages/TestCasePage.tsxä»£ç ,ä½¿ç”¨æœ€ç®€å•çš„æ¥å£ä»£ç æ¥å®Œæˆå‰ç«¯å’Œåç«¯çš„å¯¹æ¥,ä½¿ç”¨sseæµå¼è¾“å‡ºæŠ€æœ¯æ ˆ,å®æ—¶å±•ç¤ºæ™ºèƒ½ä½“çš„å†…å®¹åˆ°å‰ç«¯
```





é—²æ‚åç«¯æ¥å£å·²ç»æ²¡æœ‰é—®é¢˜,é—®é¢˜åœ¨å‰ç«¯å¤„ç†sseæµå¼æ—¥å¿—ä¸Šå­˜åœ¨ç¼ºé™·,å¯¹æ¯”chatçš„æµå¼æ—¥å¿—æ‰¾åˆ°å…¶ä¸­çš„é—®é¢˜,è¿™éƒ¨åˆ†AIä¸€ç›´ç”Ÿæˆé”™è¯¯çš„åœ°æ–¹,æˆ‘ä»¬éœ€è¦è‡ªå·±çš„å¯»æ‰¾æ ¹å› äº†



```
åˆ†æå‰åç«¯ä»£ç ,ä¿®å¤frontend/src/pages/TestCasePage.tsx,ä¸èƒ½å®æ—¶è¾“å‡ºåç«¯ç»“æœçš„åŸå› 
chat/streamæ¥å£çš„çš„è¯·æ±‚å¦‚ä¸‹:
curl -X 'POST' \
  'http://localhost:8000/api/chat/stream' \
  -H 'accept: application/json' \
  -H 'Content-Type: application/json' \
  -d '{
  "message": "ä¸€ç“¶æ°´å¦‚ä½•æµ‹è¯•",
  "conversation_id": "sdasdadad",
  "system_message": "ä½ æ˜¯ä¸€ä¸ªæœ‰ç”¨çš„AIåŠ©æ‰‹"
}'
ç»“æœå¦‚ä¸‹:
data: {"content":"æµ‹è¯•","is_complete":false,"conversation_id":"sdasdadad"}

data: {"content":"ä¸€ç“¶","is_complete":false,"conversation_id":"sdasdadad"}

data: {"content":"æ°´çš„","is_complete":false,"conversation_id":"sdasdadad"}

data: {"content":"è´¨é‡","is_complete":false,"conversation_id":"sdasdadad"}

data: {"content":"ã€","is_complete":false,"conversation_id":"sdasdadad"}

data: {"content":"å®‰å…¨æ€§","is_complete":false,"conversation_id":"sdasdadad"}

data: {"content":"æˆ–","is_complete":false,"conversation_id":"sdasdadad"}

data: {"content":"é€‚ç”¨","is_complete":false,"conversation_id":"sdasdadad"}

data: {"content":"æ€§","is_complete":false,"conversation_id":"sdasdadad"}

testcase/generate/streamingçš„è¯·æ±‚å¦‚ä¸‹
curl -X 'POST' \
  'http://localhost:8000/api/testcase/generate/streaming' \
  -H 'accept: application/json' \
  -H 'Content-Type: application/json' \
  -d '{
  "conversation_id": "dasdasdasd",
  "text_content": "ä¸€ç“¶æ°´å¦‚ä½•æµ‹è¯•",
  "files": [
    {
      "filename": "string",
      "content_type": "string",
      "size": 0,
      "content": "string"
    }
  ],
  "round_number": 1,
  "enable_streaming": true
}'
ç»“æœå¦‚ä¸‹:
data: data: {"type": "text_message", "source": "éœ€æ±‚åˆ†ææ™ºèƒ½ä½“", "content": "ğŸ” æ”¶åˆ°ç”¨æˆ·éœ€æ±‚ï¼Œå¼€å§‹è¿›è¡Œä¸“ä¸šéœ€æ±‚åˆ†æ...", "conversation_id": "dasdasdasd", "message_type": "éœ€æ±‚åˆ†æ", "is_complete": false, "timestamp": "2025-06-11T08:49:48.477729"}
data:
data:

data: data: {"type": "streaming_chunk", "source": "éœ€æ±‚åˆ†ææ™ºèƒ½ä½“", "content": "è¯·åˆ†æä»¥ä¸‹éœ€æ±‚ï¼š\n\nä¸€ç“¶æ°´å¦‚ä½•æµ‹è¯•\n\nğŸ“ é™„ä»¶æ–‡ä»¶ä¿¡æ¯:\næ–‡ä»¶æ€»æ•°: 1\n1. string (string, 0 bytes)\n", "conversation_id": "dasdasdasd", "message_type": "streaming", "timestamp": "2025-06-11T08:49:48.479356"}
data:
data:

data: data: {"type": "streaming_chunk", "source": "éœ€æ±‚åˆ†ææ™ºèƒ½ä½“", "content": "###", "conversation_id": "dasdasdasd", "message_type": "streaming", "timestamp": "2025-06-11T08:49:51.996349"}
data:
data:

data: data: {"type": "streaming_chunk", "source": "éœ€æ±‚åˆ†ææ™ºèƒ½ä½“", "content": " ", "conversation_id": "dasdasdasd", "message_type": "streaming", "timestamp": "2025-06-11T08:49:52.284181"}
data:
data:

å½“å‰æˆ‘çš„é—®é¢˜æ˜¯:chat/streamçš„ç»“æœå°±å¯ä»¥å®æ—¶çš„å±•ç¤ºåˆ°å‰ç«¯,ä½†æ˜¯testcase/generate/streamingçš„å°±ä¸è¡Œ,æ„Ÿè§‰testcase/generate/streamingè¾“å‡ºçš„ç»“æœå’Œchat/streamæœ‰å¾ˆå¤§å·®å¼‚,è¯·è¯¦ç»†åˆ†æç›¸å…³çš„å‰åç«¯å¯¹åº”çš„ä»£ç ,æ‰¾åˆ°testcase/generate/streamingåœ¨å‰ç«¯ä¸èƒ½å®æ—¶è¾“å‡ºæ—¥å¿—çš„åŸå› ,å¹¶ä¿®å¤
```

AIç»ˆäºæ‰¾åˆ°äº†é—®é¢˜çš„çœŸæ­£åŸå› 

![image-20250611090730972](assets/image-20250611090730972.png)

ä¸è¿‡æˆ‘æ„Ÿè§‰è¿™ä¸ªæ˜¯åç«¯çš„æ•°æ®æ ¼å¼é—®é¢˜,éœ€è¦AIå†æ¬¡å¸®æˆ‘ä¿®å¤

```
ç°åœ¨å‰ç«¯å¯ä»¥å®æ—¶è¾“å‡ºæ—¥å¿—äº†,ä½†æ˜¯è¿™ä¸ªé—®é¢˜æ˜¯ä¸æ˜¯åç«¯æ¥å£ä¸è§„èŒƒå¯¼è‡´çš„,å¦‚æœæ˜¯è¯·æ‰¾åˆ°åŸå› ,å¹¶ä¸”ä¿®å¤
curl -X 'POST' \
  'http://localhost:8000/api/chat/stream' \
  -H 'accept: application/json' \
  -H 'Content-Type: application/json' \
  -d '{
  "message": "ä¸€ç“¶æ°´å¦‚ä½•æµ‹è¯•",
  "conversation_id": "sdasdadad",
  "system_message": "ä½ æ˜¯ä¸€ä¸ªæœ‰ç”¨çš„AIåŠ©æ‰‹"
}'
ç»“æœå¦‚ä¸‹:
data: {"content":"æµ‹è¯•","is_complete":false,"conversation_id":"sdasdadad"}

data: {"content":"ä¸€ç“¶","is_complete":false,"conversation_id":"sdasdadad"}

data: {"content":"æ°´çš„","is_complete":false,"conversation_id":"sdasdadad"}

data: {"content":"è´¨é‡","is_complete":false,"conversation_id":"sdasdadad"}

data: {"content":"ã€","is_complete":false,"conversation_id":"sdasdadad"}

data: {"content":"å®‰å…¨æ€§","is_complete":false,"conversation_id":"sdasdadad"}

data: {"content":"æˆ–","is_complete":false,"conversation_id":"sdasdadad"}

data: {"content":"é€‚ç”¨","is_complete":false,"conversation_id":"sdasdadad"}

data: {"content":"æ€§","is_complete":false,"conversation_id":"sdasdadad"}

testcase/generate/streamingçš„è¯·æ±‚å¦‚ä¸‹
curl -X 'POST' \
  'http://localhost:8000/api/testcase/generate/streaming' \
  -H 'accept: application/json' \
  -H 'Content-Type: application/json' \
  -d '{
  "conversation_id": "dasdasdasd",
  "text_content": "ä¸€ç“¶æ°´å¦‚ä½•æµ‹è¯•",
  "files": [
    {
      "filename": "string",
      "content_type": "string",
      "size": 0,
      "content": "string"
    }
  ],
  "round_number": 1,
  "enable_streaming": true
}'
ç»“æœå¦‚ä¸‹:
data: data: {"type": "text_message", "source": "éœ€æ±‚åˆ†ææ™ºèƒ½ä½“", "content": "ğŸ” æ”¶åˆ°ç”¨æˆ·éœ€æ±‚ï¼Œå¼€å§‹è¿›è¡Œä¸“ä¸šéœ€æ±‚åˆ†æ...", "conversation_id": "dasdasdasd", "message_type": "éœ€æ±‚åˆ†æ", "is_complete": false, "timestamp": "2025-06-11T08:49:48.477729"}
data:
data:

data: data: {"type": "streaming_chunk", "source": "éœ€æ±‚åˆ†ææ™ºèƒ½ä½“", "content": "è¯·åˆ†æä»¥ä¸‹éœ€æ±‚ï¼š\n\nä¸€ç“¶æ°´å¦‚ä½•æµ‹è¯•\n\nğŸ“ é™„ä»¶æ–‡ä»¶ä¿¡æ¯:\næ–‡ä»¶æ€»æ•°: 1\n1. string (string, 0 bytes)\n", "conversation_id": "dasdasdasd", "message_type": "streaming", "timestamp": "2025-06-11T08:49:48.479356"}
data:
data:

data: data: {"type": "streaming_chunk", "source": "éœ€æ±‚åˆ†ææ™ºèƒ½ä½“", "content": "###", "conversation_id": "dasdasdasd", "message_type": "streaming", "timestamp": "2025-06-11T08:49:51.996349"}
data:
data:

data: data: {"type": "streaming_chunk", "source": "éœ€æ±‚åˆ†ææ™ºèƒ½ä½“", "content": " ", "conversation_id": "dasdasdasd", "message_type": "streaming", "timestamp": "2025-06-11T08:49:52.284181"}
data:
data:
```





### é—®é¢˜ä¼˜åŒ–

ä¸Šè¿°é—®é¢˜æˆ‘è‡ªå·±çœ‹äº†åŠå¤©,æœ€åæˆ‘è‡ªå·±æ‰¾åˆ°äº†é—®é¢˜æ‰€åœ¨

åœ¨testcase.pyçš„æ¥å£æ–‡ä»¶ä¸­,æˆ‘å¼•å…¥çš„æ˜¯`from sse_starlette.sse import EventSourceResponse` å…¶ä¸­`EventSourceResponse`åšäº†ä¸€å±‚å°è£…,æŠŠè¿”å›çš„æ•°æ®è‡ªå·±åŠ äº†ä¸€å±‚`data: {xxxx}\n\n`è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæ¥å£è¿”å›çš„ç»“æœä¸­ä¸€ç›´å¤šå‡ºæ¥data:å’Œä¸¤ä¸ªç©ºè¡Œçš„åŸå› ,æˆ‘ä»¬è‡ªå·±ä¿®å¤è¿™ä¸ªé—®é¢˜

è€Œchat.pyä¸­å¼•å…¥çš„æ˜¯`from fastapi.responses import StreamingResponse`  ç›¸å½“äºè‡ªå·±å®ç°çš„sseçš„æµå¼è¾“å‡ºè§„åˆ™





### åæœŸéœ€è¦ä¼˜åŒ–çš„é—®é¢˜(é‡è¦)

```
            # å¯åŠ¨éœ€æ±‚åˆ†ææµç¨‹
            await self.start_requirement_analysis(requirement)

            # åˆ›å»ºæµå¼è¾“å‡ºç”Ÿæˆå™¨
            async for stream_data in self._generate_streaming_output(conversation_id):
                yield stream_data
åœ¨backend/services/testcase_service.pyä¸­çš„ä¸Šè¿°ä»£ç ,
await self.start_requirement_analysis(requirement)å®Œå…¨æ‰§è¡Œå®Œæˆ,æ‰å¯ä»¥èµ°åˆ°            async for stream_data in self._generate_streaming_output(conversation_id):
                yield stream_data
è¿™ä¼šå¯¼è‡´ä¸€ä¸ªé—®é¢˜,ç¨‹åºå…¶å®ä¸æ˜¯åœ¨æœ€å¼€å§‹å°±å®æ—¶è¾“å‡ºå†…å®¹,è€Œä¸”åˆ†æå®Œæˆå,è¿™éƒ¨åˆ†å®¹æˆ‘æƒ³æƒ³,ä¸åƒwebsocketé‚£æ ·å¥½ç”¨

```



### ä¼˜åŒ–

```
backend/services/testcase_service.pyä¸­RequirementAnalysisAgentçš„è¯»å–è§£ææ–‡ä»¶çš„ä»£ç éœ€è¦ä¼˜åŒ– ,å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„ä»£ç 
from llama_index.core import SimpleDirectoryReader, Document
   async def get_document_from_files(self, files: list[str]) -> str:
        """è·å–æ–‡ä»¶å†…å®¹"""
        try:
            data = SimpleDirectoryReader(input_files=files).load_data()
            doc = Document(text="\n\n".join([d.text for d in data[0:]]))
            return doc.text
        except Exception as e:
            raise Exception(f"æ–‡ä»¶è¯»å–å¤±è´¥: {str(e)}")
ä¹Ÿå¯ä»¥é˜…è¯»https://docs.llamaindex.ai/en/stable/æ‰¾åˆ°æœ€åˆé€‚çš„æ–¹æ³•
```



### ä»£ç ç»“æ„ä¼˜åŒ–

```
åœ¨backend/coreç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªllm.py åˆ›å»ºä¸€ä¸ªå…±ç”¨çš„openai_model_client,ä»£ç å‚è€ƒ
from backend.conf.config import settings
from autogen_core.models import ModelFamily
from autogen_ext.models.openai import OpenAIChatCompletionClient
# åˆ›å»ºæ¨¡å‹å®¢æˆ·ç«¯
openai_model_client = OpenAIChatCompletionClient(
    model=settings.aimodel.model,
    base_url=settings.aimodel.base_url,
    api_key=settings.aimodel.api_key,
    model_info={
        "vision": False,
        "function_calling": True,
        "json_output": True,
        "family": ModelFamily.UNKNOWN,
        "structured_output": True,
        "multiple_system_messages": True,
    },
)
å°†backend/services/autogen_service.pyå’Œbackend/services/testcase_service.pyä¸­çš„openai_model_clientæ”¹ä¸ºä½¿ç”¨llm.py
```





### å‰ç«¯ä¼˜åŒ–

```
å‰ç«¯åœ¨ç”Ÿæˆæµ‹è¯•ç”¨ä¾‹çš„è¿‡ç¨‹ä¸­,AIåˆ†æç»“æœè¡¨çš„å†…å®¹,æœ‰éƒ¨åˆ†å†…å®¹å±•ç¤ºä¸å…¨äº†,å®Œå…¨ç”Ÿæˆå®Œæˆå,é¡µé¢åˆæ¢å¤äº†
å‰ç«¯å±•ç¤ºå†…å®¹å†—ä½™,æµ‹è¯•ç”¨ä¾‹ä¸“å®¶å’Œéœ€æ±‚åˆ†æå¸ˆå±•ç¤ºçš„å†…å®¹æœ‰ä¸¤æ¬¡
```





```
å½“å‰è¿”å›çš„å†…å®¹:æµ‹è¯•ç”¨ä¾‹æ™ºèƒ½ä½“å°±ç›¸å½“äºæµ‹è¯•ç”¨ä¾‹ä¸“å®¶,éœ€æ±‚æ™ºèƒ½ä½“ä¸ºéœ€æ±‚åˆ†æå¸ˆ,å»é™¤æµå¼è¾“å‡ºä¸­ä¸å¿…è¦çš„éƒ¨åˆ†,è®©å‰ç«¯å±•ç¤ºçš„ç»“æœä¸å†—ä½™
```



```
backend/services/testcase_service.py å¯¹åç«¯ä»£ç è¿›è¡Œ ä¼˜åŒ–,åªæœ‰æ™ºèƒ½ä½“æµå¼è¾“å‡ºè¿”å›åˆ°æ¥å£ä¸­,å…¶ä½™åªåœ¨æ—¥å¿—ä¸­åšè®°å½•
```



```
æˆ‘ä¸Šä¼ äº†ä¸€ä¸ªmdæ–‡æ¡£,å‰ç«¯çš„ç±»å‹æ£€æµ‹ä¸ºunknown,
ä¸€ä¸ªæ–‡ä»¶å‰ç«¯å±•ç¤ºä¸ºä¸¤ä¸ªç›¸åŒçš„æ–‡ä»¶,
ç‚¹å‡»æˆ–æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤åŒºåŸŸçš„é…è‰²å’Œé¡µé¢ä¸æ­,è¯·ç¾è§‚ä¸€ç‚¹
```



```
ç°åœ¨ä¸ç®¡ä¸Šä¼ ä»€ä¹ˆæ–‡ä»¶,éƒ½æ˜¾ç¤ºæ–‡ä»¶ xxxxå·²å­˜åœ¨,å¦å¤–ä¸Šä¼ åŒºåŸŸçš„é…è‰²è¿˜éœ€è¦ä¼˜åŒ–,å½“å‰ä¸å¥½çœ‹,AIåˆ†æç»“æœè¡¨ä¸­è¾“å‡ºçš„å†…å®¹ä¾‹å­:è¯·åˆ†æä»¥ä¸‹éœ€æ±‚ï¼š


æµ‹è¯•#éœ€æ±‚åˆ†ææŠ¥å‘Š##1.éœ€æ±‚æ¦‚è¿°æ‚¨æä¾›çš„éœ€æ±‚æè¿°ä¸º"æµ‹è¯•"ï¼Œè¿™æ˜¯ä¸€ä¸ªéå¸¸ç®€çŸ­çš„è¾“å…¥ã€‚ä½œä¸ºä¸“ä¸šéœ€æ±‚åˆ†æå¸ˆï¼Œæˆ‘éœ€è¦æŒ‡å‡ºè¿™ä¸ªæè¿°å­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š


1.ä¿¡æ¯é‡ä¸¥é‡ä¸è¶³ï¼Œæ— æ³•è¯†åˆ«ä»»ä½•å…·ä½“çš„
è¯·æŸ¥çœ‹å‰ç«¯ä»£ç ,ä»¥markdownçš„æ–¹å¼å±•ç¤º
```



```
é—®é¢˜ä¿®å¤:
1. ç°åœ¨ä¸Šä¼ æ–‡ä»¶,å‰ç«¯è¿˜æ˜¯æŠ¥é”™: æ–‡ä»¶ åç¨‹ä½¿ç”¨.md å·²å­˜åœ¨,éœ€è¦ä¿®å¤
2. è¯·æŸ¥çœ‹å‰ç«¯å’Œåç«¯è¿›è¡Œsseæµå¼è¾“å‡ºçš„å¤„ç†é€»è¾‘,æ˜¯ä¸æ˜¯å­˜åœ¨å†—ä½™çš„æ“ä½œ,sseçš„æ ¼å¼å¤„ç†å¯ä»¥å‚è€ƒChatPage.tsxæ–‡ä»¶
```



```
æ¥å£å“åº”æŠ¥é”™
{
  "conversation_id": null,
  "text_content": "æµ‹è¯•",
  "files": [
    {
      "content": ""
    }
  ],
  "round_number": 1,
  "enable_streaming": true
}

æ¥å£å“åº”æ— é—®é¢˜
{
  "conversation_id": null,
  "text_content": "æµ‹è¯•",
  "files": null,
  "round_number": 1,
  "enable_streaming": true
}
```





```
ä¿®å¤é—®é¢˜:
1. ä¸Šä¼ åŒºåŸŸå‡ºç°å•å‡»æœ‰æ—¶ä¸ç”Ÿæ•ˆçš„é—®é¢˜
2. æˆ‘é€šè¿‡æ¥å£å‘ç°,ä¸Šä¼ çš„æ–‡ä»¶æ²¡æœ‰è¢«æ­£ç¡®çš„è§£æ:è¯·åˆ†æä»¥ä¸‹éœ€æ±‚ï¼š
æµ‹è¯•
ğŸ“ é™„ä»¶æ–‡ä»¶ä¿¡æ¯:
æ–‡ä»¶æ€»æ•°: 1
åç¨‹ä½¿ç”¨.md (application/octet-stream, 5141 bytes)
#éœ€æ±‚åˆ†ææŠ¥å‘Š##1.æ–‡æ¡£æ¦‚è¿°æ ¹æ®æä¾›çš„é™„ä»¶"åç¨‹ä½¿ç”¨.md",è¿™æ˜¯ä¸€ä¸ªå…³äºåç¨‹(Coroutines)ä½¿ç”¨çš„æŠ€æœ¯æ–‡æ¡£ï¼Œæ–‡ä»¶å¤§å°ä¸º5141å­—èŠ‚ã€‚ç”±äºæˆ‘æ— æ³•ç›´æ¥æŸ¥çœ‹é™„ä»¶å†…å®¹ï¼Œæˆ‘å°†åŸºäº"åç¨‹ä½¿ç”¨"è¿™ä¸ªä¸»é¢˜è¿›è¡Œé€šç”¨çš„éœ€æ±‚åˆ†æã€‚
éœ€è¦è°ƒæ•´åç«¯ä»£ç 
```



```
è¯·å‚è€ƒexamples/requirements.pyå’Œexamples/requirement_agents.pyä¸­ä¸Šä¼ æ–‡ä»¶"/upload" å’ŒRequirementAcquisitionAgentå¤„ç†æ–‡ä»¶çš„é€»è¾‘,ä¿®æ”¹æœ¬é¡¹ç›®çš„å‰åç«¯backend/services/testcase_service.py  backend/api/testcase.py frontend/src/pages/TestCasePage.tsx
```





### (é‡è¦)å¾…ä¼˜åŒ–ç‚¹ memeroyè¦æŒä¹…åŒ–å­˜å‚¨

å‚è€ƒ: https://microsoft.github.io/autogen/stable/user-guide/agentchat-user-guide/memory.html  å®ç°

```
æˆ‘æƒ³æŠŠè®°å¿†æ”¾åˆ°æœ¬åœ°çš„ç£ç›˜,è¿™æ ·å°±ä¼šå‡å°‘ç£ç›˜çš„å¼€é”€,å¯ä»¥å‚è€ƒè¿™æ®µä»£ç å®ç°è¯¥åŠŸèƒ½
 åŒæ ·å¢åŠ åˆ é™¤é€»è¾‘
import os
from pathlib import Path

from autogen_agentchat.agents import AssistantAgent
from autogen_agentchat.ui import Console
from autogen_core.memory import MemoryContent, MemoryMimeType
from autogen_ext.memory.chromadb import ChromaDBVectorMemory, PersistentChromaDBVectorMemoryConfig
from autogen_ext.models.openai import OpenAIChatCompletionClient

# Initialize ChromaDB memory with custom config
chroma_user_memory = ChromaDBVectorMemory(
    config=PersistentChromaDBVectorMemoryConfig(
        collection_name="preferences",
        persistence_path=os.path.join(str(Path.home()), ".chromadb_autogen"),
        k=2,  # Return top  k results
        score_threshold=0.4,  # Minimum similarity score
    )
)
# a HttpChromaDBVectorMemoryConfig is also supported for connecting to a remote ChromaDB server

# Add user preferences to memory
await chroma_user_memory.add(
    MemoryContent(
        content="The weather should be in metric units",
        mime_type=MemoryMimeType.TEXT,
        metadata={"category": "preferences", "type": "units"},
    )
)

await chroma_user_memory.add(
    MemoryContent(
        content="Meal recipe must be vegan",
        mime_type=MemoryMimeType.TEXT,
        metadata={"category": "preferences", "type": "dietary"},
    )
)

model_client = OpenAIChatCompletionClient(
    model="gpt-4o",
)

# Create assistant agent with ChromaDB memory
assistant_agent = AssistantAgent(
    name="assistant_agent",
    model_client=model_client,
    tools=[get_weather],
    memory=[chroma_user_memory],
)

stream = assistant_agent.run_stream(task="What is the weather in New York?")
await Console(stream)

await model_client.close()
await chroma_user_memory.close()

```







### (é‡è¦)å¾…ä¼˜åŒ–ç‚¹ ç”¨æˆ·ä¸Šä¼ æ–‡ä»¶äº‘ç«¯ä¿å­˜

æœªæ¥ç”¨æˆ·ä¸Šä¼ ,å…ˆ`MD5sum` ä¸€ä¸‹,å­˜åœ¨æ•°æ®åº“å°±ä¸éœ€è¦ä¸Šä¼ ,ä¸å­˜åœ¨å°±ä¸Šä¼ ä¿å­˜

ä¿å­˜çš„æ–‡ä»¶ä¹Ÿæœ‰æ—¶æ•ˆæ€§,å®šæœŸåˆ é™¤



### åç«¯ä¼˜åŒ–,æµå¼è¿”å›ç»“æœ ä¼˜åŒ–

æˆ‘çœ‹äº†ä¸‹AIç”Ÿæˆçš„ä»£ç ,å¦‚ä¸‹,ç±»ä¼¼äºè¿™ç±»çš„ä»£ç ,å…¶å®æ²¡æœ‰æŒ‰ç…§Autogenå®˜æ–¹æ–‡æ¡£ä¸­çš„èŒƒä¾‹ä½¿ç”¨

```
            async for chunk in generator_agent.run_stream(task=generation_task):
                if hasattr(chunk, "content") and chunk.content:
                    testcases_parts.append(chunk.content)
                    # å‘é€æµå¼è¾“å‡ºå— (streaming_chunk ç±»å‹)
                    await self.publish_message(
                        ResponseMessage(
                            source="æµ‹è¯•ç”¨ä¾‹ç”Ÿæˆæ™ºèƒ½ä½“",
                            content=chunk.content,
                            message_type="streaming_chunk",  # æ ‡è®°ä¸ºæµå¼å—
                        ),
                        topic_id=TopicId(
                            type=task_result_topic_type, source=self.id.key
                        ),
                    )
                    logger.info(
                        f"ğŸ“¡ [æµ‹è¯•ç”¨ä¾‹ç”Ÿæˆæ™ºèƒ½ä½“] å‘é€æµå¼å— | å¯¹è¯ID: {conversation_id} | å†…å®¹: {chunk.content}"
                    )

```

å¦‚ä¸‹æ˜¯ä¸€ä¸ªæ ‡å‡†çš„ä½¿ç”¨

```
            async for chunk in generator_agent.run_stream(task=generation_task):
                if hasattr(chunk, "content") and chunk.content:
                    testcases_parts.append(chunk.content)
                    # å‘é€æµå¼è¾“å‡ºå— (streaming_chunk ç±»å‹)
                    await self.publish_message(
                        ResponseMessage(
                            source="æµ‹è¯•ç”¨ä¾‹ç”Ÿæˆæ™ºèƒ½ä½“",
                            content=chunk.content,
                            message_type="streaming_chunk",  # æ ‡è®°ä¸ºæµå¼å—
                        ),
                        topic_id=TopicId(
                            type=task_result_topic_type, source=self.id.key
                        ),
                    )
                    logger.info(
                        f"ğŸ“¡ [æµ‹è¯•ç”¨ä¾‹ç”Ÿæˆæ™ºèƒ½ä½“] å‘é€æµå¼å— | å¯¹è¯ID: {conversation_id} | å†…å®¹: {chunk.content}"
                    )

```





```
åœ¨backend/services/testcase_service.pyä¸­,å¯¹äºcollect_resultéƒ¨åˆ†éœ€è¦ä¼˜åŒ–
åœ¨Autogençš„ä½¿ç”¨ä¸­ result = agent.run_stream()çš„ç»“æœæœ‰ä¸‰ç±»ModelClientStreamingChunkEvent,TextMessage,TaskResult
è¾“å‡ºåˆ°å‰ç«¯çš„ä½¿ç”¨ModelClientStreamingChunkEvent,è®°å½•ç”¨æˆ·çš„é—®é¢˜å’Œåé¦ˆå¯ä»¥ä½¿ç”¨TextMessage,è®°å½•æ‰€æœ‰çš„ç»“æœå¯ä»¥ç”¨TaskResult
ä¾‹å­å¦‚ä¸‹:
import asyncio

from autogen_agentchat.agents import AssistantAgent
from autogen_agentchat.messages import ModelClientStreamingChunkEvent,TextMessage
from autogen_agentchat.base import TaskResult
from autogen_agentchat.ui import Console
from llms import openai_model_client

agent = AssistantAgent(
    name="reporter_agent",
    model_client=openai_model_client,
    system_message="ä½ æ“…é•¿ç¼–å†™å¤è¯—",
    model_client_stream=True,  # æ”¯æŒæµå¼è¾“å‡º
)
async def main_stream():
    # è·å–åç¨‹å¯¹è±¡
    result = agent.run_stream(
        task="ç¼–å†™ä¸€é¦–4è¨€å¤è¯—"
    )  # å½“å‰ä»£ç ä¸ä¼šæ‰§è¡Œrun_stream()ä¸­çš„ä»£ç ,ç›´æ¥è¿”å›åç¨‹å¯¹è±¡
    async for item in result:
        if isinstance(item, ModelClientStreamingChunkEvent):
            print(item.content, end="", flush=True)  ## æµå¼è¾“å‡º
        if isinstance(item, TextMessage):
            print(item.content)  # è¡¨ç¤ºprimaryæ™ºèƒ½ä½“æœ€ç»ˆçš„å®Œæ•´è¾“å‡º
        if isinstance(item, TaskResult):
            print(item.messages[0].content) # è®°å½•userçš„è¾“å…¥
            print(item.messages[-1].content)  # è¡¨ç¤ºprimaryæ™ºèƒ½ä½“æœ€ç»ˆçš„å®Œæ•´è¾“å‡º


async def main_console():
    await Console(agent.run_stream(task="ç¼–å†™ä¸€é¦–4è¨€å¤è¯—"))
æ ¹æ®ä¸Šé¢çš„ä¾‹å­,ä¿®æ”¹é¡¹ç›®ä¸­ç±»ä¼¼äºå¦‚ä¸‹çš„ä»£ç ,
            async for chunk in generator_agent.run_stream(task=generation_task):
                if hasattr(chunk, "content") and chunk.content:
                    testcases_parts.append(chunk.content)
                    # å‘é€æµå¼è¾“å‡ºå— (streaming_chunk ç±»å‹)
                    await self.publish_message(
                        ResponseMessage(
                            source="æµ‹è¯•ç”¨ä¾‹ç”Ÿæˆæ™ºèƒ½ä½“",
                            content=chunk.content,
                            message_type="streaming_chunk",  # æ ‡è®°ä¸ºæµå¼å—
                        ),
                        topic_id=TopicId(
                            type=task_result_topic_type, source=self.id.key
                        ),
                    )
                    logger.info(
                        f"ğŸ“¡ [æµ‹è¯•ç”¨ä¾‹ç”Ÿæˆæ™ºèƒ½ä½“] å‘é€æµå¼å— | å¯¹è¯ID: {conversation_id} | å†…å®¹: {chunk.content}"
                    )
```



ä»£ç ä¸€å®šè¦è‡ªå·±æ•²è¿‡ä¸€é,åé¢å°±å¯ä»¥ç”¨è‡ªå·±çš„ä¾‹å­,è®©AIå¸®å¿™ä¸°å¯Œ,é‚£æ ·é‡Œé¢çš„é€»è¾‘æ‰èƒ½çœ‹æ‡‚,é™¤äº†é—®é¢˜è‡ªå·±æ‰èƒ½çŸ¥é“å“ªé‡Œæœ‰é”™



```
"message_type": "æµ‹è¯•ç”¨ä¾‹ç”Ÿæˆ"

"agent_type": "agent",
      "agent_name": "æµ‹è¯•ç”¨ä¾‹ç”Ÿæˆæ™ºèƒ½ä½“",

"agent_type": "agent",
      "agent_name": "éœ€æ±‚åˆ†ææ™ºèƒ½ä½“",
```



å‰ç«¯ä¼˜åŒ–

```
frontend/src/pages/TestCasePage.tsx ä¸­å¯¹sseçš„ç‰¹æ®Šå¤„ç†æ–¹å¼ä¸frontend/src/pages/ChatPage.tsxä¸­å¯¹sseçš„å¤„ç†æ–¹å¼å¯¹å…¶
```





```
frontend/src/pages/TestCasePage.tsx
é‡æ–°æ¢³ç†åç«¯é€»è¾‘,å‰ç«¯æŒ‰ç…§åç«¯æ¥å£æ¥å®ç°(å‰ç«¯é‡å†™)
1. ç”¨æˆ·è¾“å‡ºè¯·æ±‚(æ–‡ä»¶+æ–‡å­—æè¿°) -> /testcase/generate/streaming -> å‰ç«¯å±•ç¤ºå†…å®¹åœ¨AIåˆ†æç»“æœè¡¨ä¸‹:

ç”¨æˆ·æ¨¡å—: ç”¨æˆ·éœ€æ±‚: type=text_message message_type=éœ€æ±‚åˆ†æ æ–‡æ¡£è§£æç»“æœ: type=text_message message_type=æ–‡æ¡£è§£æç»“æœ
éœ€æ±‚åˆ†ææ™ºèƒ½ä½“: type=streaming_chunk source=éœ€æ±‚åˆ†ææ™ºèƒ½ä½“

```





å½“å‰å…ˆæäº¤ä»£ç ,å¾…ä¸‹æ¬¡ä¼˜åŒ–
